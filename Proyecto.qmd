---
title: "Proyecto"
author: "Diego Franco, Daniel Gonzalez, Angel Carrera"
format: html
editor: visual
---

```{r echo=F, include=FALSE}
library(nortest)
library(dplyr)
library(hopkins)
library(factoextra)
library(ggrepel)
library(cluster)
library(flexclust)
library(FeatureImpCluster)
library(stringr)
library(tidyr)
library(stats)
library(graphics)
library(NbClust)
library(mclust)
library(GGally)
library(corrplot)
library(caret)
library(ggplot2)
library(kableExtra)
library(e1071)
library(rpart)
library(rpart.plot)
library(naivebayes)
library(randomForest)
library(RColorBrewer)
```

```{r echo=F, include=FALSE}
datos <- read.csv("defunciones_fetales.csv")
```

## Defunciones fetales en Guatemala

### Situacion Problematica

La falta de una atención médica adecuada durante el parto trae múltiples problemas. Por un lado, produce complicaciones que desembocan en múltiples defunciones fetales. Además, también pone en riesgo la salud y vida de la madre. Por lo tanto, el acceso a atención médica adecuada y condiciones higiénicas puede reducir el riesgo de muerte. En Guatemala fallecen anualmente cerca de 2800 fetos, por lo que un sistema de salud adecuado es imprescindible para poder mitigar el peligro de las muertes durante el parto.

Un estudio por (Kestler & Ambrosio, 2022), mostró que la atención de una emergencia obstétrica por parte de personal capacitado, puede ayudar a reducir en un 23% el riesgo de muerte del feto. También se evidenció que la mayor cantidad de defunciones fetales se da en ámbitos no hospitalarios, con el 81%. Estos partos son atendidos por comadronas o familiares que pueden no tener la preparación necesaria. Algunos de los factores que influyen en la asistencia recibida por las madres pueden ser la edad, la escolaridad de la madre y el acceso a instalaciones adecuadas.

Por otra parte, existe una brecha en la cantidad de emergencias atendidas en el área urbana y rural. 83% de los partos atendidos en el área urbana son atendidos en centros adecuados de salud, mientras que en el área rural solo 55%. Desde luego, Guatemala es el departamento que más partos atiende en centros de salud, seguido por Escuintla y Santa Rosa. (MSPAS, 2017)

En Guatemala se puede observar que la asistencia prenatal es muy baja, lo que es realmente delicado porque la falta de acceso a servicios de salud adecuados durante un embarazo puede traer graves consecuencias tanto para la madre como para el feto, en este caso se pude observar que llega al punto de contribuir a gran cantidad de defunciones fetales.

Con esta situación es necesario tomar medidas para mejorar en generar los servicios de salud en el país, enfocándose en brindar una asistencia prenatal de mejor calidad para reducir cualquier riesgo relacionado con el embarazo de la madre y disminuir las defunciones fetales.

### Problema Científico

A raiz de que existe esta situación a nivel nacional nos queremos enfocar en determinar si el factor geografico influye en la calidad de asistencia que se puede brindar, asimismo evaluar la eficiencia de las intervenciones actuales de cada region para proponer posibles soluciones de mejora que aborden las regiones que tengan una calidad de asistencia más baja.

Por lo mismo el *objetivo principal* de este estudio es:

-   Analizar la relación entre la baja asistencia prenatal y la tasa de mortalidad fetal en las diferentes regiones de Guatemala.

Dentro de los *objetivos especificos* se encuentra:

-   Analizar la relacion que existe entre la educacion materna y la asistencia prenatal en Guatemala.
-   Determinar si existen patrones temporales en las defunciones fetales a nivel nacional.
-   Obtener las primeras 5 regiones que necesitan mejorar la calidad de asistencia prenatal en Guatemala.

### Tipo de cada una de las variables de dataset.

-   DEPREG (Departamento de registro) -\> Categórica nominal\
-   MUPREG (Municipio de registro) -\> Categórica nominal\
-   MESREG (Mes de registro) -\> Categórica nominal\
-   AÑOREG (Año de registro) -\> Categórica nominal\
-   DEPOCU (Departamento de ocurrencia) -\> Categórica nominal\
-   MUPOCU (Municipio de ocurrencia) -\> Categórica nominal\
-   SEXO (de la defunción fetal) -\> Categórica nominal\
-   DIAOCU (Día de ocurrencia) -\> Categórica nominal\
-   MESOCU (Mes de ocurrencia) -\> Categórica nominal\
-   TIPAR (Tipo de parto) -\> Categórica nominal\
-   CLAPAR (Clase de parto) -\> Categórica nominal\
-   VIAPAR (Via del parto) -\> Categórica nominal\
-   SEMGES (Semanas de gestación) -\> Cuantitativa discreta\
-   EDADM (Edad de la madre) -\> Cuantitativa discreta\
-   DEPREM (Departamento de residencia de la madre) -\> Categórica nominal\
-   MUPREM (Municipio de residencia de la madre) -\> Categórica nominal\
-   ESCIVM (Estado civil de la madre) -\> Categórica nominal\
-   NACIOM (Nacionalidad de la madre) -\> Categórica nominal\
-   ESCOLAM (Escolaridad de la madre) -\> Categórica nominal\
-   CAUDEF (Causa de defunción) -\> Categórica nominal\
-   ASISREC (Asistencia recibida) -\> Categórica nominal\
-   SITIOOCU (Sitio de ocurrencia) -\> Categórica nominal\
-   TOHITE (Total de hijos tenidos) -\> Cuantitativa discreta\
-   TOHINM (Total de hijos nacidos muertos) -\> Cuantitativa discreta\
-   TOHIVI (Total de hijos vivos) -\> Cuantitativa discreta

### 1. Análsis de NA y limpieza

Los datos tienen un encoding en el que se pone un número (como 99 o 999) para indicar que no se tiene información. Por lo tanto es necesario reemplazar estos números por NA.

```{r echo=F}
datos$SEXO <- ifelse(datos$SEXO == 9, NA, datos$SEXO)
datos$SEMGES <- ifelse(datos$SEMGES == 99, NA, datos$SEMGES)
datos$EDADM <- ifelse(datos$EDADM == 999, NA, datos$EDADM)
datos$DEPREM <- ifelse(datos$DEPREM == 9999, NA, datos$DEPREM)
datos$MUPREM <- ifelse(datos$MUPREM == 9999, NA, datos$MUPREM)
datos$ESCIVM <- ifelse(datos$ESCIVM == 9, NA, datos$ESCIVM)
datos$NACIOM <- ifelse(datos$NACIOM == 9, NA, datos$NACIOM)
datos$ESCOLAM <- ifelse(datos$ESCOLAM == 9, NA, datos$ESCOLAM)
datos$SITIOOCU <- ifelse(datos$SITIOOCU == 9, NA, datos$SITIOOCU)
datos$TOHITE <- ifelse(datos$TOHITE == 99, NA, datos$TOHITE)
datos$TOHINM <- ifelse(datos$TOHINM == 99, NA, datos$TOHINM)
datos$TOHIVI <- ifelse(datos$TOHIVI == 99, NA, datos$TOHIVI)
```

Además, también se tienen muchas variables con valores numéricos pero que son cualitativas. Por lo tanto, se conviertieron en factores.

```{r echo=F}
cualitativas <- c('DEPREG', 'MUPREG', 'MESREG', 'AÑOREG', 'DEPOCU', 'MUPOCU', 'SEXO', 'DIAOCU', 'MESOCU', 'TIPAR', 'CLAPAR', 'VIAPAR', 'DEPREM', 'MUPREM', 'ESCIVM', 'NACIOM', 'ESCOLAM', 'CAUDEF', 'ASISREC', 'SITIOOCU')
datos[, cualitativas] <- lapply(datos[, cualitativas], as.factor)
```

```{r echo=F}
colSums(is.na(datos))
```

Es posible observar que se tienen valores faltantes en la cantidad de hijos tenidos, de hijos fallecidos y de hijos vivos. Además, también se tienen en el sexo de la defunción, la semana de gestación, la edad de la madre, el departamenteo y municipio de residencia de la madre, la escolaridad de la madre y el estado civil de la madre.

Los datos faltantes no se eliminaron acá, si no que al momento de hacer clustering se obtuvieron las variables cuantitativas y a esas se les quitaron los NA.

### 2. Resúmen del conjunto de datos.

El conjunto de datos está compuesto por `r nrow(datos)` filas y `r ncol(datos)` columnas.

```{r}
summary(datos)
```

-   Es posible observar que la media de semanas de gestación está en 36. Un 75% de las defunciones se dieron abajo de las 44 semanas.
-   La media de la edad de las madres es de 27 años. Un 75% de las madres está por debajo de los 33 años. La madre de mayor edad tiene 57 años.
-   La media de hijos tenidos es de 4. El 75% de las madres tienen 5 hijos o menos. Existe una madre con 32 hijos tenidos. La media de hijos fallecidos es de 1.27. Un 75% de las madres solo han tenido 1 hijo fallecido. Existe una madre que tiene 30 hijos fallecidos.
-   El 75% de las madres tienen 4 o menos hijos vivos. Existe una madre que tiene 16 hijos vivos.

### 3. Analisis de las variables

```{r echo=F}
datos$SEXO <- ifelse(datos$SEXO == 9, NA, datos$SEXO)
datos$SEMGES <- ifelse(datos$SEMGES == 99, NA, datos$SEMGES)
datos$EDADM <- ifelse(datos$EDADM == 999, NA, datos$EDADM)

datos$DEPREM <- ifelse(datos$DEPREM == 99, NA, datos$SEXO)
datos$MUPREM <- ifelse(datos$MUPREM == 9999, NA, datos$SEXO)
datos$ESCIVM <- ifelse(datos$ESCIVM == 9, NA, datos$SEXO)
datos$NACIOM <- ifelse(datos$NACIOM == 9999, NA, datos$SEXO)

datos$ESCOLAM <- ifelse(datos$ESCOLAM == 9, NA, datos$ESCOLAM)
datos$SITIOOCU <- ifelse(datos$SITIOOCU == 9, NA, datos$SITIOOCU)
datos$TOHITE <- ifelse(datos$TOHITE == 99, NA, datos$TOHITE)
datos$TOHINM <- ifelse(datos$TOHINM == 99, NA, datos$TOHINM)
datos$TOHIVI <- ifelse(datos$TOHIVI == 99, NA, datos$TOHIVI)
```

### 3.2 Análisis de normalidad varibales cuantitativas

### Prueba de normalidad para **SEMGES**.

Inicialmente se muestra un histograma de la distribución de EDADM.

```{r echo=F}
semana_ges <- datos[datos$SEMGES != 99, ]
hist(semana_ges$SEMGES)
```

Se puede observar del histograma que hay datos muy atípicos en el extremo derecho. Es muy probable que la distribución no sea normal. Es posible observar que hay una fuerte frecuencia en el extremo derecho, como se mencionó.

A continuación se realizó un QQplot para observar la distribución de los valores de SEMGES.

```{r echo=FALSE}
qqnorm(semana_ges$SEMGES)
qqline(semana_ges$SEMGES, col="red")
```

Se puede observar del gráfico que la cola izquierda se aleja de la línea teórica y la cola derecha está mucho más alejada. Por lo tanto, la distribución de los datos no es normal.

A continuación se hizo un test de normalidad con Lilliefors.

```{r echo=F}
lillie.test(semana_ges$SEMGES)
```

Es posible observar que el valor p es muy pequeño, mucho menor que el nivel de significancia de 0.05. Por lo tanto, se puede afirmar que la distribución de los datos no es normal.

### Prueba de normalidad para **EDADM**.

Inicialmente se muestra un histograma de la distribución de EDADM.

```{r echo=F}
edad_madre <- datos[datos$EDADM != 999, ]
hist(edad_madre$EDADM)
```

Es posible observar del histograma que la distribución de los datos esta sesgada hacia la derecha. Es muy posible que no sea normal.

A continuación se realizó un QQplot para observar la distribución de los valores de EDADM.

```{r echo=FALSE}
qqnorm(edad_madre$EDADM)
qqline(edad_madre$EDADM, col="red")
```

Al observar el gráfico se puede observar que los extremos están bastante alejados de la línea teórica, por lo que es muy probable que no se tenga una distribución normal.

Finalmente se hizo un test de normalidad con Lilliefors.

```{r echo=F}
lillie.test(edad_madre$EDADM)
```

Se puede observar que el valor p es mucho menor al nivel de significancia, que es de 0.05, por lo que se puede afirmar que la distribución no sigue una distribución normal.

### Prueba de normalidad para **TOHITE**.

Inicialmente se muestra un histograma de la distribución de TOHITE.

```{r echo=F}
hijos_tenidos <- datos[datos$TOHITE != 99, ]
hist(hijos_tenidos$TOHITE)
```

Se observar del histograma que hay un fuerte sesgo hacia la izquierda. La forma de la distribución no parece normal.

A continuación se realizó un QQplot para observar la distribución de los valores de TOHITE.

```{r echo=FALSE}
qqnorm(hijos_tenidos$TOHITE)
qqline(hijos_tenidos$TOHITE, col="red")
```

Se puede observar que la gráfica tiene una forma de gradas. La distribución está bastante alejada de la línea teórica. Es muy probable que no sea normal.

Finalmente se realizó un test de normalidad con Lilliefors.

```{r echo=F}
lillie.test(hijos_tenidos$TOHITE)
```

Es posible observar que el valor de p es mucho más bajo al nivel de significancia. Se puede afirmar que la distribución no sigue una forma normal.

### Prueba de normalidad para **TOHINM**.

Inicialmente se muestra un histograma de la distribución de TOHINM.

```{r echo=F}
hijos_muertos <- datos[datos$TOHINM != 99, ]
hist(hijos_muertos$TOHINM)
```

Se puede observar que la mayor cantidad de datos se encuentra en el extemo izquierdo. La distribución no tiene forma normal.

A continuación se realizó un QQplot para observar la distribución de los valores de TOHINM.

```{r echo=FALSE}
qqnorm(hijos_muertos$TOHINM)
qqline(hijos_muertos$TOHINM, col="red")
```

El extremo derecho se aleja bastante de la línea teórica. Es muy probable que no se tenga una distribución normal de los datos.

Finalmente se hizo un test de normalidad con Lilliefors.

```{r echo=F}
lillie.test(hijos_muertos$TOHINM)
```

Se puede observar que el valor p es mucho menor que el nivel de significancia, de 0.05, por lo que se rechaza la hipótesis de que la distribución es normal.

### Prueba de normalidad para **TOHIVI**.

Inicialmente se muestra un histograma de la distribución de TOHIVI.

```{r echo=F}
hijos_vivos <- datos[datos$TOHIVI != 99, ]
hist(hijos_vivos$TOHIVI)
```

Se puede observar que se tiene un sesgo a la izquierda. La distribución no tiene formal normal.

A continuación se realizó un QQplot para observar la distribución de los valores de TOHIVI.

```{r echo=FALSE}
qqnorm(hijos_vivos$TOHIVI)
qqline(hijos_vivos$TOHIVI, col="red")
```

Se observa que la distribución tiene una forma de gradas y se aleja bastante de la línea teórica. Es muy probable que no sea normal.

```{r echo=F}
lillie.test(hijos_vivos$TOHIVI)
```

El valor de p es mucho menor que el nivel de significancia, por lo que se rechaza la hipótesis de que se tiene una distribución normal.

### 3.3 Análisis de distribución de variables cuantitativas

#### Análisis para semana de gestación

```{r echo=F}
boxplot(semana_ges$SEMGES,
  main = "Semanas de gestación",
  col = "orange",
  border = "brown",
  horizontal = TRUE,
  notch = TRUE
)
```

Es posible observar que un 50% de los datos están por debajo de aproximadamente la semana 37. Se tienen muchos datos atípicos en el extremo inferior. Las muertes fetales tempranas ocurren entre las 20 y 27 semanas, mientras que las tardías de 28 a 36 semanas. De esta forma, la mayoría de defunciones están en el rango de las 20 a las 40 semanas, sin embargo, en el dataset se tienen defunciones por debajo de las 20 semanas, que son los múltiples datos atípicos que se pueden observar.

#### Análisis para edad de la madre

```{r echo=F}
boxplot(edad_madre$EDADM,
  main = "Edad de la madre",
  col = "orange",
  border = "brown",
  horizontal = TRUE,
  notch = TRUE
)
```

Es posible observar que existen datos atípicos en el extremo superior, luego de los 50 años. La edad mínima es de 10 años. Un 50% de los datos se encuentran por debajo de aproximadamente los 27 o 28 años. Se puede observar que a partir del tercer cuartil hay más dispersión. La edad fértil de una mujer está entre los 19 y 30 años, y esta va disminuyendo hasta aproximadamente los 50 años. La mayoría de madres se encuentran entre este rango de años, pero existen datos atípicos que están arriba de los 50 años. Algo importante a resaltar es que existen madres de 10 años que se encuentran en el rango normal.

#### Análisis para total de hijos tenidos

```{r echo=F}
boxplot(hijos_tenidos$TOHITE,
  main = "Total de hijos tenidos",
  col = "orange",
  border = "brown",
  horizontal = TRUE,
  notch = TRUE
)
```

Es posible observar que el 50% de los datos se enceuntran por debajo de los 3 hijos aproximadamente. Se puede observar una gran cantidad de datos atípicos. La menor cantidad de hijos tenidos es 1. Hay bastante dispersión después del tercer cuartil. Existe un registro que tiene 32 hijos tenidos, el valor más atípico. Además, el promedio de hijos tenidos en Guatemala es de aproximadamente 6. Los datos atípicos representan mujeres que han tenido muchos hijos, como el dato de 32 que se menciona.

#### Análisis para total de hijos fallecidos

```{r echo=F}
boxplot(hijos_muertos$TOHINM,
  main = "Total de hijos fallecidos",
  col = "orange",
  border = "brown",
  horizontal = TRUE,
  notch = TRUE
)
```

Se puede observar que hay una gran cantidad de datos atípicos en esta distribución. La mayoría de datos tienen 1 hijo fallecido, que muy probablemnte sea el que se registró en el dataset. Muchas madres han tenido más de 1 hijo fallecido que son los datos atípicos, hasta un dato extremo de 30 hijos fallecidos. Esta persona puede tener una condición médica que no le permite formar los hijos correctamente.

#### Análisis para total de hijos vivos

```{r echo=F}
boxplot(hijos_vivos$TOHIVI,
  main = "Total de hijos vivos",
  col = "orange",
  border = "brown",
  horizontal = TRUE,
  notch = TRUE
)
```

Se puede observar que el 50% de los datos están por debajo de aproximadamente 2 hijos. Se tienen muchos datos atípicos y hay bastante dispersión en la distribución. El valor menor de hijos vivos es de 0 y hay personas que tienen más de 15 hijos vivos.

### 3.4 Análisis de frecuencia varibales cualitativas

A continuación se muestra la frecuencia de **DEPREG** el departamento de registro.

```{r echo=F}
departamento <- table(datos$DEPREG)
departamento
barplot(departamento, col=c("orange", "blue"))
```

La gráfica muestra que la mayor cantidad de abortos se registran en el departamento de Guatemala seguido de Alta Verapaz como el segundo más alto. Esto puede indicar que la mayoría de personas reciben asistencia en el departamento de Guatemala, independientemente de donde vivan.

A continuación se muestra la frecuencia de **MUPREG** el municipio de registro.

```{r echo=F}
municipio <- table(datos$MUPREG)
municipio
barplot(municipio, col=c("orange", "blue"))
```

La gráfica muestra que la mayor cantidad de abortos se registran en el municipio de Guatemala. Esto indica que en el departamento de Guatemala, es en la capital donde más se producen las defunciones fetales.

A continuación se muestra la frecuencia de **MESREG** el mes de registro.

```{r echo=F}
mes_re <- table(datos$MESREG)
mes_re
barplot(mes_re, col=c("orange", "blue"))
```

La gráfica muestra que los meses de registro se encuentran balanceados entre si, aunque el mes con mayor registros es enero.

A continuación se muestra la frecuencia de **AÑOREG** el año de registro.

```{r echo=F}
ano_re <- table(datos$AÑOREG)
ano_re
barplot(ano_re, col=c("orange", "blue"))
```

La gráfica muestra que los años de registro se encuentran bastante balanceados entre si, aunque el año con mayor registros es 2013. Se observa una tendencia a una menor cantidad de defunciones mientras pasan los años.

A continuación se muestra la frecuencia de **DEPOCU** el departamento de ocurrencia.

```{r echo=F}
dep_ocu <- table(datos$DEPOCU)
dep_ocu
barplot(dep_ocu, col=c("orange", "blue"))
```

La gráfica muestra que la mayor cantidad de abortos son ocurridos en el departamento de Guatemala seguido de Alta Verapaz como el segundo más alto.

A continuación se muestra la frecuencia de **MUPOCU** el municipio de ocurrencia.

```{r echo=F}
mun_ocu <- table(datos$MUPOCU)
mun_ocu
barplot(mun_ocu, col=c("orange", "blue"))
```

La gráfica muestra que la mayor cantidad de abortos son ocurridos en el municipio de Guatemala

A continuación se muestra la frecuencia de **SEXO** de la defuncion fetal.

```{r echo=F}
sexo <- table(datos$SEXO)
sexo
barplot(sexo, col=c("orange", "blue"))
```

La gráfica muestra que el sexo de la defuncion fetal mayormente son masculinos. Sin embargo, están bastante balanceados.

A continuación se muestra la frecuencia de **DIAOCU** el dia de ocurrencia.

```{r echo=F}
dia <- table(datos$DIAOCU)
dia
barplot(dia, col=c("orange", "blue"))
```

La gráfica muestra que los dias de ocurrencia estan bastante balanceados.

A continuación se muestra la frecuencia de **MESOCU** el mes de ocurrencia.

```{r echo=F}
mes <- table(datos$MESOCU)
mes
barplot(mes, col=c("orange", "blue"))
```

La gráfica muestra que al igual que con los dias los meses estan bastante balanceados pero si se puede observar que existe una mayor catidad en el mes de enero.

A continuación se muestra la frecuencia de **TIPAR** el tipo de parto.

```{r echo=F}
tipoP <- table(datos$TIPAR)
tipoP
barplot(tipoP, col=c("orange", "blue"))
```

La gráfica muestra que la mayoria de los partos fueron de tipo simple.

A continuación se muestra la frecuencia de **CLAPAR** el clase de parto.

```{r echo=F}
claseP <- table(datos$CLAPAR)
claseP
barplot(claseP, col=c("orange", "blue"))
```

La gráfica muestra que la mayoria de los partos fueron de clase eutocio.

A continuación se muestra la frecuencia de **VIAPAR** la via del parto.

```{r echo=F}
viaP <- table(datos$VIAPAR)
viaP
barplot(viaP, col=c("orange", "blue"))
```

La gráfica muestra que la mayoria de los partos fueron por via vaginal.

A continuación se muestra la frecuencia de **DEPREM** el departamento de residencia de la madre.

```{r echo=F}
depM <- table(datos$DEPREM)
depM
barplot(depM, col=c("orange", "blue"))
```

La gráfica muestra que la mayoria de las madres son residentes del departamento de Guatemala.

A continuación se muestra la frecuencia de **MUPREM** el municipio de residencia de la madre.

```{r echo=F}
munM <- table(datos$MUPREM)
munM
barplot(munM, col=c("orange", "blue"))
```

La gráfica muestra que la mayoria de las madres son residentes del municipio de Guatemala.

A continuación se muestra la frecuencia de **ESCIVM** el estado civil de la madre.

```{r echo=F}
estadoC <- table(datos$ESCIVM)
estadoC
barplot(estadoC, col=c("orange", "blue"))
```

La gráfica muestra que la mayoria de las madres eran solteras.

A continuación se muestra la frecuencia de **NACIOM** la nacionalidad de la madre.

```{r echo=F}
nacionalidad <- table(datos$NACIOM)
nacionalidad
barplot(nacionalidad, col=c("orange", "blue"))
```

La gráfica muestra que casi todas las madres tienen una nacionalidad guatemalteca, aunque se muestran variedad de nacionalidades.

A continuación se muestra la frecuencia de **ESCOLAM** la escolaridad de la madre.

```{r echo=F}
escolaridad <- table(datos$ESCOLAM)
escolaridad
barplot(escolaridad, col=c("orange", "blue"))
```

La gráfica indica que la gran mayoria de las madres no recibieron ningun tipo de estudios, y que el segundo grupo de madres solo llego a estudios primarios.

A continuación se muestra la frecuencia de **CAUDEF** la causa de la defuncion.

```{r echo=F}
causaDef <- table(datos$CAUDEF)
causaDef
barplot(causaDef, col=c("orange", "blue"))
```

La gráfica muestra que la mayoria de las causas de defuncion son no especificadas o por Hipoxia intrauterina, no especificada.

A continuación se muestra la frecuencia de **ASISREC** la asistencia recibida.

```{r echo=F}
asistencia <- table(datos$ASISREC)
asistencia
barplot(asistencia, col=c("orange", "blue"))
```

Al observar el grafico podemos observar que la mayoria de los abortos recibieron asistencia medica.

A continuación se muestra la frecuencia de **SITIOOCU** sitio de ocurrencia.

```{r echo=F}
sitio <- table(datos$SITIOOCU)
sitio
barplot(sitio, col=c("orange", "blue"))
```

Al observar el grafico podemos observar que la mayoria de los abortos ocurrieron en un Hospital publico.

### 3.4 Matriz de correlación entre variables

```{r echo=F}
numericas <- c("SEMGES", "EDADM", "TOHITE", "TOHINM", "TOHIVI")
cualitativas <- datos[, !(names(datos) %in% numericas)]
datosT <- datos %>% mutate_at(colnames(cualitativas), function(x) as.factor(x))
datosT <- mutate_if(datos, is.numeric, scale)
numericas_norm <- datos[, numericas]
numericas_temp <- numericas_norm
numericas_norm <- numericas_norm[complete.cases(numericas_norm), ]
corr_matrix <- cor(numericas_norm)
corrplot(corr_matrix)
```

Es posible observar que existe una correlación entre la cantidad de hijos tenidos y la edad de la madre. Esto quiere decir que mientras más edad tiene una madre, más hijos ha tenido. Por otra parte, se tiene una leve correlación entre la cantidad de hijos fallecidos con la cantidad de hijos tenidos. La cantidad de hijos vivos tiene una muy fuerte correlación con la cantidad de hijos vivos. La cantidad de hijos vivos también tiene correlación con la edad de la madre.

### 4. Preguntas de investigacion

#### 4.1. ¿Cual es la edad promedio de las madres que abortan?

```{r echo=F}
edad <- datos$EDADM
mean(edad, na.rm = T)
```

La edad promedio de las madres que abortan es de 27.

#### 4.2. ¿Existe algún patrón temporal en las defunciones fetales?

```{r echo=F}
time_df <- datos
time_df$fecha <- as.Date(paste(time_df$AÑOREG, time_df$MESREG, '01', sep='-'), format = "%Y-%m-%d")
table <- table(time_df$fecha)
min_date <- min(time_df$fecha)
max_date <- max(time_df$fecha)
ts_counts <- ts(table, start = c(year(min_date), month(min_date)), frequency = 12)

plot.ts(ts_counts, main = "Serie de tiempo de defunciones fetales", xlab = "Fecha", ylab = "Cantidad")

fit <- decompose(ts_counts)
plot(fit)
```

Al observar la serie de tiempo se puede observar que hay una tendencia en la reducción de la cantidad de defunciones fetales a lo largo de los años. Un factor importante por notar es que existe una estacionalidad marcada en las defunciones fetales, se puede visualizar un ciclo que se repite aproximadamente cada año y medio en la cantidad de estas.

#### 4.3 ¿Existe una relación entre el departamento de registro y la atención médica recibida?

```{r}
tabla_contingencia <- table(datos$DEPREG, datos$ASISREC)
tabla_contingencia
resultado_chi_cuadrado <- chisq.test(tabla_contingencia)
resultado_chi_cuadrado
```

Al realizar una tabla de contingencia y realizar un test de chi-cuadrado es posible observar que el valor de p es menor al nivel de significancia, de 0.05. Esto quiere decir que el departamento de registro de la defunción está relacionado con la asistencia recibida.

#### 4.4 ¿La causa de defunción está relacionada con las semanas de gestación de la madre?

```{r}
causas_por_semana <- aggregate(CAUDEF ~ SEMGES, data = datos, function(x) {
  causas <- table(x)
  names(causas)[which.max(causas)]
})

causas_por_semana
```

#### 4.5 ¿Cual es el Promedio de defunciones por año?

```{r}

# Agrupar por año de registro
data_grouped_anoreg <- datos %>%
  group_by(AÑOREG) %>%
  summarise(Defunciones = n()) %>%
  ungroup()

# Mostrar el resultado
ggplot(data_grouped_anoreg, aes(x = AÑOREG, y = Defunciones, fill = factor(AÑOREG))) +
  geom_bar(stat = "identity", position = "dodge") +
  theme_minimal() +
  labs(title = "Defunciones fetales por año",
       x = "Año de registro",
       y = "Número de defunciones fetales")

# Calcular el promedio de defunciones fetales por año
promedio_defunciones_anuales <- mean(data_grouped_anoreg$Defunciones)

# Mostrar el resultado
cat("El promedio de defunciones fetales por año es:", promedio_defunciones_anuales)


```

Al evaular la grafica podemos observar que la mayoria de las defunciones fetales ocurren en el departamento de Guatemala y en el municipio de Guatemala.

#### 4.6 ¿El estado civil de la madre influye en la probabilidad de una defunción fetal?

```{r}
# Agrupar por estado civil de la madre
data_grouped_escivm <- datos %>%
  group_by(ESCIVM) %>%
  summarise(Defunciones = n()) %>%
  ungroup()

# Visualizar resultados
ggplot(data_grouped_escivm, aes(x = ESCIVM, y = Defunciones, fill = ESCIVM)) +
  geom_bar(stat = "identity", position = "dodge") +
  theme_minimal() +
  labs(title = "Defunciones fetales por estado civil de la madre",
       x = "Estado civil de la madre",
       y = "Número de defunciones fetales")

```

Al observar la tabla podemos ver que la mayoria de las defunciones fetales ocurrieron en madres solteras.

#### 4.7 ¿Las madres con más hijos tenidos tienen una mayor proporción de defunciones fetales?

```{r}
# Agrupar por total de hijos tenidos
data_grouped_hijos <- datos %>%
  group_by(TOHITE) %>%
  summarise(Defunciones = n()) %>%
  ungroup()

# Visualizar resultados
ggplot(data_grouped_hijos, aes(x = TOHITE, y = Defunciones, fill = TOHITE)) +
  geom_bar(stat = "identity", position = "dodge") +
  theme_minimal() +
  labs(title = "Defunciones fetales por total de hijos tenidos",
       x = "Total de hijos tenidos",
       y = "Número de defunciones fetales")

```

Al observar el grafico podemos ver que a medida de que se tengan mas hijos es menor la probabilidad de tener una defuncion fetal.a partir de 1 hijo tenido. ya que este es el que tiene la mayor probabilidad de tener una defuncion fetal.

#### 4.8 ¿Los sitios de ocurrencia tienen un impacto en la tasa de defunciones fetales?

```{r ESTA TIRA ERROR}

# Agrupar por escolaridad de la madre
data_grouped_escolam <- datos %>%
  group_by(ESCOLAM) %>%
  summarise(Defunciones = n()) %>%
  ungroup()

# Visualizar resultados
ggplot(data_grouped_escolam, aes(x = ESCOLAM, y = Defunciones, fill = factor(ESCOLAM))) +
  geom_bar(stat = "identity", position = "dodge") +
  theme_minimal() +
  labs(title = "Defunciones fetales por escolaridad de la madre",
       x = "Escolaridad de la madre",
       y = "Número de defunciones fetales")

```

Podemos observar que la mayoria de las defunciones fetales ocurren en madres con un nivel de escolaridad baja o nula.

#### 4.9 ¿Existe alguna relación entre la vía del parto y la escolaridad de la madre en las defunciones fetales?

```{r}
# Crear una tabla de contingencia para el recuento de casos por vía del parto y escolaridad de la madre
data_grouped <- datos %>%
  count(ESCOLAM, VIAPAR) %>%
  rename(Escolaridad = ESCOLAM, ViaParto = VIAPAR, Casos = n)

# Visualizar resultados en un gráfico de barras apiladas
ggplot(data_grouped, aes(x = factor(Escolaridad), y = Casos, fill = factor(ViaParto))) +
  geom_bar(stat = "identity") +
  theme_minimal() +
  labs(title = "Relación entre la vía del parto y la escolaridad de la madre en defunciones fetales",
       x = "Escolaridad de la madre",
       y = "Número de casos",
       fill = "Vía del parto")
```

Se puede observar que el mes de gestacion con mayor probabilidad de tener una defuncion fetal es el mes 1, sin embargo todos los meses estan en un rango similar de probabilidad de tener una defuncion fetal.

#### 4.10 ¿Existe alguna relación entre la semana de gestacíon y la via del parto?

```{r echo=F}
datos_seleccionados <- select(datos, SEMGES, VIAPAR)

ggplot(data = datos_seleccionados, aes(x = VIAPAR, y = SEMGES)) +
  geom_boxplot() +
  labs(x = "Vía del parto", y = "Semanas de gestación") +
  ggtitle("Relación entre la semana de gestación y la vía del parto")
```

Como se puede observar en el diagrama de caja y bigoteindica la separacion de los bigotes es considerablemente alta lo que nos indica que hay una diferencia en las semanas de gestación según la vía del parto. En otras palabras, que si existe una relación entre estas dos variables.

#### 4.11 ¿Cómo se distribuye la asistencia médica recibida?

```{r echo=F}
tabla <- table(datos$ASISREC)
data <- as.data.frame(tabla)
colnames(data) <- c('ASISREC', 'count')
# Compute percentages
data$fraction = data$count / sum(data$count)

# Compute the cumulative percentages (top of each rectangle)
data$ymax = cumsum(data$fraction)

# Compute the bottom of each rectangle
data$ymin = c(0, head(data$ymax, n=-1))
 
# Make the plot
ggplot(data, aes(ymax=ymax, ymin=ymin, xmax=4, xmin=3, fill=ASISREC)) +
     geom_rect() +
     coord_polar(theta="y") + # Try to remove that to understand how the chart is built initially
     xlim(c(2, 4)) # Try to remove that to see how to make a pie chart

```

Se puede observar que la mayor cantidad de veces se recibe asistencia médica, que pertenece al código 1. Luego se puede observar que varias emergencias son atendidas por una comadrona. Bastantes defunciones fetales no tuvieron asistencia alguna, lo que corresponde a la porción del código 5.

#### 4.12 ¿Cuáles son las 5 semanas de gestación donde más defunciones se dan?

```{r}
temp <- datos[complete.cases(datos), ]
temp <- temp %>%
        group_by(SEMGES) %>%
        summarise(count=n())

top_semanas <- temp %>%
      top_n(n=5, wt=count)

ggplot(top_semanas, aes(x = SEMGES, y = count)) +
  geom_bar(stat = "identity", fill = "steelblue") +
  ggtitle("Top 5 semanas con más defunciones") +
  xlab("Semanas de gestación") +
  ylab("Número de defunciones")
```

Las semanas donde más defunciones se dan van de la 36 a la 50. La mayor cantidad de defunciones se da en la semana 40, la cual es una semana bastante tardía.

#### 4.13 ¿Cuál es la frecuencia del sitio de ocurrencia de los partos?

```{r echo=F}
tabla <- table(datos$SITIOOCU)
data <- as.data.frame(tabla)
colnames(data) <- c('SITIOOCU', 'count')
# Compute percentages
data$fraction = data$count / sum(data$count)

# Compute the cumulative percentages (top of each rectangle)
data$ymax = cumsum(data$fraction)

# Compute the bottom of each rectangle
data$ymin = c(0, head(data$ymax, n=-1))
 
# Make the plot
ggplot(data, aes(ymax=ymax, ymin=ymin, xmax=4, xmin=3, fill=SITIOOCU)) +
     geom_rect() +
     coord_polar(theta="y") + # Try to remove that to understand how the chart is built initially
     xlim(c(2, 4)) # Try to remove that to see how to make a pie chart

```

La mayoría de defunciones se dán en hospitales públicos. Este dato es importante, porque puede indicar alguna deficiencia en este tipo de hospitales. Interesantemente, la siguiente categoría en defunciones fetales es en domicilios, correspondiente al código 6. El seguro social y hospitales privados reportan una cantidad muy similar de defunciones.

## 5. Clustering

### 5.1 Determinar si vale la pena agrupar

```{r echo=F}
set.seed(123)

h<-hopkins(numericas_norm)
distancia <- dist(numericas_norm)

# fviz_dist(distancia, show_labels = F)
```

Se calculó el estadístico de Hopkins para determinar si es válido agrupar los datos. El valor de este es de `r round(h, 2)`, por lo que si vale la pena intentar un agrupamiento.

### 5.2 Determinar la cantidad de grupos para el cluster

#### Metodo de wss y silueta

```{r echo=F, metodo_wss}

set.seed(123)

wss <- 0

wss <- 0
for (i in 1:10) {
  wss[i] <- sum(kmeans(numericas_norm, centers=i)$withinss)
}

## 5.4 Grafica de lineas y puntos bow
plot(1:10, wss, type="bow", xlab="Cantidad de grupos", ylab="wss")

#fviz_nbclust(numericas_norm, kmeans, method="wss")
fviz_nbclust(numericas_norm, kmeans, method="silhouette")
```

Es posible observar de la gráfica del codo que la cantidad de grupos óptima son 3. La silueta indica lo mismo, así que se procederá a realizar esta cantidad.

### 5.3 Por k medias

#### 5.3.1 Agrupamiento

```{r kmedias}
set.seed(123)
km <- kmeans(numericas_norm, centers = 3, iter.max = 100)

# find number of observations in each cluster
table(km$cluster)
```

```{r}
fviz_cluster(km, numericas_norm)
```

#### 5.3.2 Calidad del agrupamiento segun el método de la silueta

```{r}
set.seed(123)
m <- data.frame(withinss = km$withinss, size = km$size)
ggplot(m, aes(size, withinss)) +
    geom_point() +
    geom_smooth(method = "lm") +
    labs(x = "cardinalidad (size)", y = "magnitud (whithinss)") +
    geom_text_repel(label = rownames(m))
silueta <- silhouette(km$cluster, distancia)
mean <- mean(silueta[, 3])
mean
```

La silueta es de `r round(mean, 2)`, lo cual es un valor relativamente alto que indica que con 3 grupos se genera un agrupamiento aceptable.

```{r}
set.seed(123)
res <- kcca(numericas_norm, 3)
importance <- FeatureImpCluster(res, as.data.table(numericas_norm))
plot(importance)
barplot(res, bycluster = T)
```

#### 5.3.3 Clasificacion de los grupos

```{r}
df <- datos[complete.cases(numericas_temp), ]
df$grupo <- km$cluster

grupo1 <- df[df$grupo == 1,]
grupo2 <- df[df$grupo == 2,]
grupo3 <- df[df$grupo == 3,]

```

##### Grupo 1

```{r}
summary(grupo1[,numericas])
str(grupo1)
sort(prop.table(table(grupo1$DEPREG))*100, decreasing=T)
sort(prop.table(table(grupo1$TIPAR))*100, decreasing=T)
sort(prop.table(table(grupo1$CLAPAR))*100, decreasing=T)
sort(prop.table(table(grupo1$VIAPAR))*100, decreasing=T)
sort(prop.table(table(grupo1$DEPREM))*100, decreasing=T)
sort(prop.table(table(grupo1$ESCIVM))*100, decreasing=T)
sort(prop.table(table(grupo1$ESCOLAM))*100, decreasing=T)
sort(prop.table(table(grupo1$SEXO))*100, decreasing=T)
sort(prop.table(table(grupo1$MESREG))*100, decreasing=T)
sort(prop.table(table(grupo1$NACIOM))*100, decreasing=T)
sort(prop.table(table(grupo1$CAUDEF))*100, decreasing=T)
sort(prop.table(table(grupo1$ASISREC))*100, decreasing=T)
sort(prop.table(table(grupo1$SITIOOCU))*100, decreasing=T)
```

Características principales del grupo:

-   Las semanas de gestación en las que se produjo la defunción van de 1 a 33. El 50% de las defunciones se produjeron abajo de la semana 27.
-   La edad promedio de las madres es de 27 años. Siendo la edad mínima 11 y la máxima 45.
-   La cantidad de hijos tenidos para el grupo va de 1 a 11, siendo el promedio de 3. El 50% de las observaciones están por debajo de los 3 hijos tenidos.
-   La cantidad de hijos vivos en promedio es 1 hijo, siendo que el 75% de las mujeres solo tienen 2 hijos vivos o menos.
-   En este grupo la mayoría de mujeres tienen 1 hijo en el parto y un 6.6% tienen 2.
-   En este grupo la mayoría de mujeres, un 39%, tienen una educación primaria. Un 26% tienen educación nula.

Con las caracteristicas mencionadas anteriormente podemos denotar a este grupo como "grupo de madres jovenes que tuvieron una defunción temprana, mayormente con educación primaria".

##### Grupo 2

```{r}
summary(grupo2[,numericas])
str(grupo2)

sort(prop.table(table(grupo2$DEPREG))*100, decreasing=T)
sort(prop.table(table(grupo2$TIPAR))*100, decreasing=T)
sort(prop.table(table(grupo2$CLAPAR))*100, decreasing=T)
sort(prop.table(table(grupo2$VIAPAR))*100, decreasing=T)
sort(prop.table(table(grupo2$DEPREM))*100, decreasing=T)
sort(prop.table(table(grupo2$ESCIVM))*100, decreasing=T)
sort(prop.table(table(grupo2$ESCOLAM))*100, decreasing=T)
sort(prop.table(table(grupo2$SEXO))*100, decreasing=T)
sort(prop.table(table(grupo2$MESREG))*100, decreasing=T)
sort(prop.table(table(grupo2$NACIOM))*100, decreasing=T)
sort(prop.table(table(grupo2$CAUDEF))*100, decreasing=T)
sort(prop.table(table(grupo2$ASISREC))*100, decreasing=T)
sort(prop.table(table(grupo2$SITIOOCU))*100, decreasing=T)
```

Características principales del grupo:

-   Las semanas de gestación en las que se produjo la defunción van de 30 a 44. El 50% de las defunciones fueron abajo de la semana 38.
-   La edad promedio de la mujer era de 25 años. Siendo la edad mínima 14 y la máxima 32. Teniendo que el 75% de las mujeres tenian menos de 28 años.
-   La cantidad de hijos tenidos para el grupo va de 1 a 12, siendo el promedio de 3. El 50% de las observaciones están por debajo de los 3 hijos tenidos, al igual que el grupo 2.
-   La media de la cantidad de hijos vivos es de 1 hijo. El 50% de las observaciones están por debajo de los 2 hijos vivos.
-   En este grupo la mayoría de mujeres tienen 1 hijo en el parto y un 3.86% tienen 2.
-   En este grupo la mayoría de mujeres, un 42%, tienen una educación primaria. Un 35% tienen educación nula.

Con las caracteristicas mencionadas anteriormente podemos denotar a este grupo como "grupo de madres jovenes que tuvieron una defunción tardía, mayormente con educación primaria y nula".

##### Grupo 3

```{r}
summary(grupo3[,numericas])
str(grupo3)

sort(prop.table(table(grupo3$DEPREG))*100, decreasing=T)
sort(prop.table(table(grupo3$TIPAR))*100, decreasing=T)
sort(prop.table(table(grupo3$CLAPAR))*100, decreasing=T)
sort(prop.table(table(grupo3$VIAPAR))*100, decreasing=T)
sort(prop.table(table(grupo3$DEPREM))*100, decreasing=T)
sort(prop.table(table(grupo3$ESCIVM))*100, decreasing=T)
sort(prop.table(table(grupo3$ESCOLAM))*100, decreasing=T)
sort(prop.table(table(grupo3$SEXO))*100, decreasing=T)
sort(prop.table(table(grupo3$MESREG))*100, decreasing=T)
sort(prop.table(table(grupo3$NACIOM))*100, decreasing=T)
sort(prop.table(table(grupo3$CAUDEF))*100, decreasing=T)
sort(prop.table(table(grupo3$ASISREC))*100, decreasing=T)
sort(prop.table(table(grupo3$SITIOOCU))*100, decreasing=T)
```

Características principales del grupo:

-   Las semanas de gestación en las que se produjo la defunción van de 22 a 44. El 50% de las defunciones fueron abajo de la semana 38.
-   La edad promedio de la mujer era de 36 años. Siendo la edad mínima 29 y la máxima 57. Teniendo que el 75% de las mujeres tenian entre 29 y 39 años.
-   La cantidad de hijos tenidos para el grupo va de 1 a 32, siendo el promedio de 6. El 75% de las observaciones están por debajo de los 7 hijos tenidos.
-   La cantidad de hijos vivos en promedio es de 4. El 75% de las observaciones tienen menos de 6 hijos vivos.
-   En este grupo la mayoría de mujeres tienen 1 hijo en el parto y un 2.7% tienen 2.
-   En este grupo la mayoría de mujeres, un 53%, no tienen educación. Un 33% tienen educación primara.

Con las caracteristicas mencionadas anteriormente podemos denotar a este grupo como "grupo de madres mayores con mayor cantidad de hijos tenidos con escolaridad mayormente nula".

### Resumen del analisis exploratorio

Luego de realizar el analisis exploratorio sobre los datos de las defunciones fetales en Guatemala desde el 2010 hasta el 2019, de forma general podemos concluir que: Guatemala es lastimosamente un pais donde la cantidad de defunciones fetales es muy alta, teniendo un promedio de 2,774 defunciones fetales por año. siendo que más del 50% de las defunciones fetales ocurren enntre la semana 36 a la 50 de gestación pero mayormente se dan en la semana 40 por lo que indica que los fetos ya habian llegado a desarrllarse bastante, esto ocurre en todas las regiones de nuestro pais y muy tristemente en todo tipo de mujeres. La mayoria de las defunciones fetales ocurren en mujeres de entre 20 y 30 años, aunque el 75% de las mujeres tienen menos de 28 años. A pesar de ello podemos encontrar niñas de tan solo 10 año que han tenido que enfrentar la muerte de su hijo. Normalmente las mujeres tienen 1 hijo en el parto pero existe un 6.6% de muejres que tienen 2. De las madres tambien se obtuvo que un 39%, tienen una educación primaria y un 26% tienen educación nula, pero la gran mayoria de las defunciones fetales ocurren en mujeres que no tienen educación.

Sobre datos un poco más especificos se pudo observar que existe relacion entre variables como el departamento de ocurrencia de la defuncion con la atencion medica que se recibe en este departamento, lo que nos indica que a menor antencion medica existe una mayor probabilidad de que la defuncion fetal ocurra. Por lo que se puede concluir que en Guatemala existe una gran desigualdad en cuanto a la atencion medica que se recibe en cada departamento y con este estudio se quiere detectar que departamentos son los que tienen una aistencia medica mas baja, para asi poder mejorarla y constribuir a la reduccion de la cantidad de defunciones fetales.

Por ultimo se pudo observar que existe una tendencia en la reducción de la cantidad de defunciones fetales a lo largo de los años, lo que nos da un poco de esperanza porque se puede visualizar un ciclo que se repite aproximadamente cada año y medio en donde la cantidad de estas reduce.

### Referencias

-   Kestler, E., & Ambrosio, G. (2022). Nacido muerto en la comunidad y su relación con la morbilidad materna aguda y grave. Revista Médica (Colegio de Médicos Y Cirujanos de Guatemala), 161(2), 105--112. https://doi.org/10.36109/rmg.v161i2.484MSPAS. (2017). VI

-   Encuesta Nacional de Salud Materno Infantil (ENSMI) 2014-2015 Informe Final. https://www.ine.gob.gt/sistema/uploads/2021/04/27/20210427195413QDinUvuRa9GjopyXaTuNMXc3gd6Jq1Q1.pdf

---
title: "Proyecto"
author: "Diego Franco, Daniel Gonzalez, Angel Carrera"
format: html
editor: visual
---

```{r echo=F}
library(nortest)
library(dplyr)
library(hopkins)
library(factoextra)
library(ggrepel)
library(cluster)
library(flexclust)
library(FeatureImpCluster)
library(stringr)
library(tidyr)
library(stats)
library(graphics)
library(NbClust)
library(mclust)
library(GGally)
library(corrplot)
library(caret)
library(ggplot2)
library(kableExtra)
library(e1071)
library(rpart)
library(rpart.plot)
library(naivebayes)
library(randomForest)
```


```{r}
datos <- read.csv("defunciones_fetales.csv")
```

## Defunciones fetales en Guatemala

### 1. Resumen del conjunto de datos.  

El conjunto de datos está compuesto por `r nrow(datos)` filas
y `r ncol(datos)` columnas.

```{r}
summary(datos)
numericas <- c("SEMGES", "EDADM", "TOHITE", "TOHINM", "TOHIVI")
cualitativas <- datos[, !(names(datos) %in% numericas)]
datos <- datos %>% mutate_at(colnames(cualitativas), function(x) as.factor(x))
datos <- mutate_if(datos, is.numeric, scale)
```

### 2. Tipo de cada una de las variables de dataset.  

- DEPREG (Departamento de registro) -> Categórica nominal    
- MUPREG (Municipio de registro) -> Categórica nominal    
- MESREG (Mes de registro) -> Categórica nominal      
- AÑOREG (Año de registro) -> Categórica nominal    
- DEPOCU (Departamento de ocurrencia) -> Categórica nominal    
- MUPOCU (Municipio de ocurrencia) -> Categórica nominal    
- SEXO (de la defunción fetal) -> Categórica nominal    
- DIAOCU (Día de ocurrencia) -> Categórica nominal    
- MESOCU (Mes de ocurrencia) -> Categórica nominal    
- TIPAR (Tipo de parto) -> Categórica nominal    
- CLAPAR (Clase de parto) -> Categórica nominal    
- VIAPAR (Via del parto) -> Categórica nominal    
- SEMGES (Semanas de gestación) -> Cuantitativa discreta  
- EDADM (Edad de la madre) -> Cuantitativa discreta  
- DEPREM (Departamento de residencia de la madre) -> Categórica nominal    
- MUPREM (Municipio de residencia de la madre) -> Categórica nominal    
- ESCIVM (Estado civil de la madre) -> Categórica nominal  
- NACIOM (Nacionalidad de la madre) -> Categórica nominal  
- ESCOLAM (Escoladirdad de la madre) -> Categórica nominal  
- CAUDEF (Causa de defunción) -> Categórica nominal  
- ASISREC (Asistencia recibida) -> Categórica nominal  
- SITIOOCU (Sitio de ocurrencia) -> Categórica nominal  
- TOHITE (Total de hijos tenidos) -> Cuantitativa discreta  
- TOHINM (Total de hijos nacidos muertos) -> Cuantitativa discreta  
- TOHIVI (Total de hijos vivos) -> Cuantitativa discreta  

### 3. Analisis de las variables

### 3.5 Análsis de NA

```{r echo=F}
colSums(is.na(datos))
```

Es posible observar que se tienen valores faltantes en la cantidad de hijos tenidos, de hijos fallecidos y de hijos vivos.

Se tienen múltiples variables donde se usa 999 o 9 como código de un valor ignorado. Se reemplazarán estos valores por NA.

```{r echo=F}
datos$SEXO <- ifelse(datos$SEXO == 9, NA, datos$SEXO)
datos$SEMGES <- ifelse(datos$SEMGES == 99, NA, datos$SEMGES)
datos$EDADM <- ifelse(datos$EDADM == 999, NA, datos$EDADM)

datos$DEPREM <- ifelse(datos$DEPREM == 99, NA, datos$SEXO)
datos$MUPREM <- ifelse(datos$MUPREM == 9999, NA, datos$SEXO)
datos$ESCIVM <- ifelse(datos$ESCIVM == 9, NA, datos$SEXO)
datos$NACIOM <- ifelse(datos$NACIOM == 9999, NA, datos$SEXO)

datos$ESCOLAM <- ifelse(datos$ESCOLAM == 9, NA, datos$ESCOLAM)
datos$SITIOOCU <- ifelse(datos$SITIOOCU == 9, NA, datos$SITIOOCU)
datos$TOHITE <- ifelse(datos$TOHITE == 99, NA, datos$TOHITE)
datos$TOHINM <- ifelse(datos$TOHINM == 99, NA, datos$TOHINM)
datos$TOHIVI <- ifelse(datos$TOHIVI == 99, NA, datos$TOHIVI)
```

### 3.1 Análisis de normalidad varibales cuantitativas

### Prueba de normalidad para **SEMGES**.  
  
Inicialmente se muestra un histograma de la distribución de EDADM.

```{r echo=F}
semana_ges <- datos[datos$SEMGES != 99, ]
hist(semana_ges$SEMGES)
```
Se puede observar del histograma que hay datos muy atípicos en el extremo derecho. Es muy probable que la distribución no sea normal. Es posible observar que hay una fuerte frecuencia en el extremo derecho, como se mencionó.


A continuación se realizó un QQplot para observar la distribución de los
valores de SEMGES.  
```{r echo=FALSE}
qqnorm(semana_ges$SEMGES)
qqline(semana_ges$SEMGES, col="red")
```
Se puede observar del gráfico que la cola izquierda se aleja de la línea teórica y la cola derecha está mucho más alejada. Por lo tanto, la distribución de los datos no es normal.


A continuación se hizo un test de normalidad con Lilliefors.
```{r echo=F}
lillie.test(semana_ges$SEMGES)
```

Es posible observar que el valor p es muy pequeño, mucho menor que el nivel de significancia de 0.05. Por lo tanto, se puede afirmar que la distribución de los datos no es normal.

### Prueba de normalidad para **EDADM**.  
  
Inicialmente se muestra un histograma de la distribución de EDADM.

```{r echo=F}
edad_madre <- datos[datos$EDADM != 999, ]
hist(edad_madre$EDADM)
```
Es posible observar del histograma que la distribución de los datos esta sesgada hacia la derecha. Es muy posible que no sea normal.

A continuación se realizó un QQplot para observar la distribución de los
valores de EDADM.  
```{r echo=FALSE}
qqnorm(edad_madre$EDADM)
qqline(edad_madre$EDADM, col="red")
```
Al observar el gráfico se puede observar que los extremos están bastante alejados de la línea teórica, por lo que es muy probable que no se tenga una distribución normal.

Finalmente se hizo un test de normalidad con Lilliefors.
```{r echo=F}
lillie.test(edad_madre$EDADM)
```
Se puede observar que el valor p es mucho menor al nivel de significancia, que es de 0.05, por lo que se puede afirmar que la distribución no sigue una distribución normal.


### Prueba de normalidad para **TOHITE**.  
  
Inicialmente se muestra un histograma de la distribución de TOHITE.

```{r echo=F}
hijos_tenidos <- datos[datos$TOHITE != 99, ]
hist(hijos_tenidos$TOHITE)
```
Se observar del histograma que hay un fuerte sesgo hacia la izquierda. La forma de la distribución no parece normal.


A continuación se realizó un QQplot para observar la distribución de los
valores de TOHITE.  
```{r echo=FALSE}
qqnorm(hijos_tenidos$TOHITE)
qqline(hijos_tenidos$TOHITE, col="red")
```

Se puede observar que la gráfica tiene una forma de gradas. La distribución está bastante alejada de la línea teórica. Es muy probable que no sea normal.

Finalmente se realizó un test de normalidad con Lilliefors.
```{r echo=F}
lillie.test(hijos_tenidos$TOHITE)
```

Es posible observar que el valor de p es mucho más bajo al nivel de significancia. Se puede afirmar que la distribución no sigue una forma normal.


### Prueba de normalidad para **TOHINM**.  
  
Inicialmente se muestra un histograma de la distribución de TOHINM.

```{r echo=F}
hijos_muertos <- datos[datos$TOHINM != 99, ]
hist(hijos_muertos$TOHINM)
```
Se puede observar que la mayor cantidad de datos se encuentra en el extemo izquierdo. La distribución no tiene forma normal.

A continuación se realizó un QQplot para observar la distribución de los
valores de TOHINM.  
```{r echo=FALSE}
qqnorm(hijos_muertos$TOHINM)
qqline(hijos_muertos$TOHINM, col="red")
```
El extremo derecho se aleja bastante de la línea teórica. Es muy probable que no se tenga una distribución normal de los datos.

Finalmente se hizo un test de normalidad con Lilliefors.
```{r echo=F}
lillie.test(hijos_muertos$TOHINM)
```
Se puede observar que el valor p es mucho menor que el nivel de significancia, de 0.05, por lo que se rechaza la hipótesis de que la distribución es normal.


### Prueba de normalidad para **TOHIVI**.  
  
Inicialmente se muestra un histograma de la distribución de TOHIVI.

```{r echo=F}
hijos_vivos <- datos[datos$TOHIVI != 99, ]
hist(hijos_vivos$TOHIVI)
```
Se puede observar que se tiene un sesgo a la izquierda. La distribución no tiene formal normal.

A continuación se realizó un QQplot para observar la distribución de los
valores de TOHIVI.  
```{r echo=FALSE}
qqnorm(hijos_vivos$TOHIVI)
qqline(hijos_vivos$TOHIVI, col="red")
```
Se observa que la distribución tiene una forma de gradas y se aleja bastante de la línea teórica. Es muy probable que no sea normal.

```{r echo=F}
lillie.test(hijos_vivos$TOHIVI)
```
El valor de p es mucho menor que el nivel de significancia, por lo que se rechaza la hipótesis de que se tiene una distribución normal.

### 3.2 Análisis de distribución de variables cuantitativas

#### Análisis para semana de gestación
```{r echo=F}
boxplot(semana_ges$SEMGES,
  main = "Semanas de gestación",
  col = "orange",
  border = "brown",
  horizontal = TRUE,
  notch = TRUE
)
```
Es posible observar que un 50% de los datos están por debajo de aproximadamente la semana 37. Se tienen muchos datos atípicos en el extremo inferior.

#### Análisis para edad de la madre
```{r echo=F}
boxplot(edad_madre$EDADM,
  main = "Edad de la madre",
  col = "orange",
  border = "brown",
  horizontal = TRUE,
  notch = TRUE
)
```
Es posible observar que existen datos atípicos en el extremo superior, luego de los 50 años. La edad mínima es de 10 años. Un 50% de los datos se encuentran por debajo de aproximadamente los 27 o 28 años. Se puede observar que a partir del tercer cuartil hay más dispersión.

#### Análisis para total de hijos tenidos
```{r echo=F}
boxplot(hijos_tenidos$TOHITE,
  main = "Total de hijos tenidos",
  col = "orange",
  border = "brown",
  horizontal = TRUE,
  notch = TRUE
)
```
Es posible observar que el 50% de los datos se enceuntran por debajo de los 3 hijos aproximadamente. Se puede observar una gran cantidad de datos atípicos. La menor cantidad de hijos tenidos es 1. Hay bastante dispersión después del tercer cuartil.

#### Análisis para total de hijos fallecidos
```{r echo=F}
boxplot(hijos_muertos$TOHINM,
  main = "Total de hijos fallecidos",
  col = "orange",
  border = "brown",
  horizontal = TRUE,
  notch = TRUE
)
```
Se puede observar que hay una gran cantidad de datos atípicos en esta distribución. La mayoría de datos está en 1 hijo fallecido.

#### Análisis para total de hijos vivos
```{r echo=F}
boxplot(hijos_vivos$TOHIVI,
  main = "Total de hijos vivos",
  col = "orange",
  border = "brown",
  horizontal = TRUE,
  notch = TRUE
)
```
Se puede observar que el 50% de los datos están por debajo de aproximadamente 2 hijos. Se tienen muchos datos atípicos y hay bastante dispersión en la distribución. El valor menor de hijos vivos es de 0 y hay personas que tienen más de 15 hijos vivos.

### 3.3 Análisis de frecuencia varibales cualitativas

A continuación se muestra la frecuencia de **DEPREG** el departamento de registro.
```{r echo=F}
departamento <- table(datos$DEPREG)
departamento
barplot(departamento, col=c("orange", "blue"))
```
La gráfica muestra que la mayor cantidad de abortos se registran en el departamento de Guatemala seguido de Alta Verapaz como el segundo  más alto.


A continuación se muestra la frecuencia de **MUPREG** el municipio de registro.
```{r echo=F}
municipio <- table(datos$MUPREG)
municipio
barplot(municipio, col=c("orange", "blue"))
```
La gráfica muestra que la mayor cantidad de abortos se registran en el municipio de Guatemala

A continuación se muestra la frecuencia de **MESREG** el mes de registro.
```{r echo=F}
mes_re <- table(datos$MESREG)
mes_re
barplot(mes_re, col=c("orange", "blue"))
```
La gráfica muestra que los meses de registro se encuentran balanceados entre si, aunque el mes con mayor registros es enero.

A continuación se muestra la frecuencia de **AÑOREG** el año de registro.
```{r echo=F}
ano_re <- table(datos$AÑOREG)
ano_re
barplot(ano_re, col=c("orange", "blue"))
```
La gráfica muestra que los años de registro se encuentran bastante balanceados entre si, aunque el año con mayor registros es 2013.

A continuación se muestra la frecuencia de **DEPOCU** el departamento de ocurrencia.
```{r echo=F}
dep_ocu <- table(datos$DEPOCU)
dep_ocu
barplot(dep_ocu, col=c("orange", "blue"))
```
La gráfica muestra que la mayor cantidad de abortos son ocurridos en el departamento de Guatemala seguido de Alta Verapaz como el segundo  más alto.

A continuación se muestra la frecuencia de **MUPOCU** el municipio de ocurrencia.
```{r echo=F}
mun_ocu <- table(datos$MUPOCU)
mun_ocu
barplot(mun_ocu, col=c("orange", "blue"))
```
La gráfica muestra que la mayor cantidad de abortos son ocurridos en el municipio de Guatemala

A continuación se muestra la frecuencia de **SEXO** de la defuncion fetal.
```{r echo=F}
sexo <- table(datos$SEXO)
sexo
barplot(sexo, col=c("orange", "blue"))
```
La gráfica muestra que el sexo de la defuncion fetal mayor mente son masculinos.

A continuación se muestra la frecuencia de **DIAOCU** el dia de ocurrencia.
```{r echo=F}
dia <- table(datos$DIAOCU)
dia
barplot(dia, col=c("orange", "blue"))
```
La gráfica muestra que los dias de ocurrencia estan bastante balanceados.

A continuación se muestra la frecuencia de **MESOCU** el mes de ocurrencia.
```{r echo=F}
mes <- table(datos$MESOCU)
mes
barplot(mes, col=c("orange", "blue"))
```
La gráfica muestra que al igual que con los dias los meses estan bastante balanceados pero si se puede observar que existe una mayor catidad en el mes de enero.

A continuación se muestra la frecuencia de **TIPAR** el tipo de parto.
```{r echo=F}
tipoP <- table(datos$TIPAR)
tipoP
barplot(tipoP, col=c("orange", "blue"))
```
La gráfica muestra que la mayoria de los partos fueron de tipo simple.

A continuación se muestra la frecuencia de **CLAPAR** el clase de parto.
```{r echo=F}
claseP <- table(datos$CLAPAR)
claseP
barplot(claseP, col=c("orange", "blue"))
```
La gráfica muestra que la mayoria de los partos fueron de clase eutocio.

A continuación se muestra la frecuencia de **VIAPAR** la via del parto.
```{r echo=F}
viaP <- table(datos$VIAPAR)
viaP
barplot(viaP, col=c("orange", "blue"))
```
La gráfica muestra que la mayoria de los partos fueron por via vaginal.

A continuación se muestra la frecuencia de **DEPREM** el departamento de residencia de la madre.
```{r echo=F}
depM <- table(datos$DEPREM)
depM
barplot(depM, col=c("orange", "blue"))
```
La gráfica muestra que la mayoria de las madres son recidentes del departamento de Guatemala.

A continuación se muestra la frecuencia de **MUPREM** el municipio de residencia de la madre.
```{r echo=F}
munM <- table(datos$MUPREM)
munM
barplot(munM, col=c("orange", "blue"))
```
La gráfica muestra que la mayoria de las madres son recidentes del municipio de Guatemala.

A continuación se muestra la frecuencia de **ESCIVM** el estado civil de la madre.
```{r echo=F}
estadoC <- table(datos$ESCIVM)
estadoC
barplot(estadoC, col=c("orange", "blue"))
```
La gráfica muestra que la mayoria de las madres eran solteras.

A continuación se muestra la frecuencia de **NACIOM** la nacionalidad de la madre.
```{r echo=F}
nacionalidad <- table(datos$NACIOM)
nacionalidad
barplot(nacionalidad, col=c("orange", "blue"))
```
La gráfica muestra que casi todas las madres tienen una nacionalidad guatemalteca, aunque se muestran variedad de nacionalidades.

A continuación se muestra la frecuencia de **ESCOLAM** la escolaridad de la madre.
```{r echo=F}
escolaridad <- table(datos$ESCOLAM)
escolaridad
barplot(escolaridad, col=c("orange", "blue"))
```
La gráfica indica que la gran mayoria de las madres no recibieron ningun tipo de estudios, y que el segundo grupo de madres solo llego a estudios primarios.

A continuación se muestra la frecuencia de **CAUDEF** la causa de la defuncion.
```{r echo=F}
causaDef <- table(datos$CAUDEF)
causaDef
barplot(causaDef, col=c("orange", "blue"))
```
La gráfica muestra que la mayoria de las causas de defuncion son no especificadas o por Hipoxia intrauterina, no especificada.

A continuación se muestra la frecuencia de **ASISREC** la asistencia recibida.
```{r echo=F}
asistencia <- table(datos$ASISREC)
asistencia
barplot(asistencia, col=c("orange", "blue"))
```
Al observar el grafico podemos observar que la mayoria de los abortos recibieron asistencia medica.

A continuación se muestra la frecuencia de **SITIOOCU** sitio de ocurrencia.
```{r echo=F}
sitio <- table(datos$SITIOOCU)
sitio
barplot(sitio, col=c("orange", "blue"))
```
Al observar el grafico podemos observar que la mayoria de los abortos ocurrieron en un Hospital publico.


### 3.4 Matriz de correlación entre variables
```{r echo=F}
numericas_norm <- datos[, numericas]
head(numericas_norm)
corr_matrix <- cor(numericas_norm)
corrplot(corr_matrix)
```




## Preguntas de investigacion

### 1. ¿Cual es la edad promedio de las madres que abortan?
```{r echo=F}
edad <- datos$EDADM
mean(edad)


```

### 2. ¿Existe algún patrón temporal en las defunciones fetales?
```{r echo=F}
time_df <- datos
time_df$fecha <- as.Date(paste(time_df$AÑOREG, time_df$MESREG, '01', sep='-'), format = "%Y-%m-%d")
head(time_df$fecha)
table <- table(time_df$fecha)
min_date <- min(time_df$fecha)
max_date <- max(time_df$fecha)
table
ts_counts <- ts(table, start = c(year(min_date), month(min_date)), end = c(year(max_date), month(max_date)), frequency = 12)

plot.ts(ts_counts, main = "Time Series Plot", xlab = "Date", ylab = "Value")

fit <- decompose(ts_counts)
#fit <- decompose(data_serie, type='multiplicative')

# Para graficar esta descomposición volvemos a emplear la funcion autoplot, pero con el objeto fit
plot(fit)
```
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.335">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Diego Franco, Daniel Gonzalez, Angel Carrera">

<title>Proyecto</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="Proyecto_modelos_files/libs/clipboard/clipboard.min.js"></script>
<script src="Proyecto_modelos_files/libs/quarto-html/quarto.js"></script>
<script src="Proyecto_modelos_files/libs/quarto-html/popper.min.js"></script>
<script src="Proyecto_modelos_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="Proyecto_modelos_files/libs/quarto-html/anchor.min.js"></script>
<link href="Proyecto_modelos_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="Proyecto_modelos_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="Proyecto_modelos_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="Proyecto_modelos_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="Proyecto_modelos_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">


</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Proyecto</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Diego Franco, Daniel Gonzalez, Angel Carrera </p>
          </div>
  </div>
    
  
    
  </div>
  

</header>

<section id="análsis-de-na-y-limpieza" class="level3">
<h3 class="anchored" data-anchor-id="análsis-de-na-y-limpieza">1. Análsis de NA y limpieza</h3>
<p>Los datos tienen un encoding en el que se pone un número (como 99 o 999) para indicar que no se tiene información. Por lo tanto es necesario reemplazar estos números por NA.</p>
<div class="cell">

</div>
<p>Además, también se tienen muchas variables con valores numéricos pero que son cualitativas. Por lo tanto, se conviertieron en factores.</p>
<div class="cell">

</div>
</section>
<section id="eliminación-de-variables-no-significativas" class="level2">
<h2 class="anchored" data-anchor-id="eliminación-de-variables-no-significativas">Eliminación de variables no significativas</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>datos <span class="ot">&lt;-</span> <span class="fu">na.omit</span>(datos)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>datos <span class="ot">&lt;-</span> <span class="fu">select</span>(datos, <span class="sc">-</span>SEMGES, <span class="sc">-</span>MUPREG, <span class="sc">-</span>MUPOCU, <span class="sc">-</span>DEPOCU, <span class="sc">-</span>MUPREM, <span class="sc">-</span>DEPREG, <span class="sc">-</span>DEPREM, <span class="sc">-</span>TOHITE, <span class="sc">-</span>AÑOREG)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="co"># colnames(datos)[2] &lt;- 'ANOREG'</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="creación-de-train-y-test" class="level2">
<h2 class="anchored" data-anchor-id="creación-de-train-y-test">Creación de train y test</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>porcentaje <span class="ot">&lt;-</span> <span class="fl">0.7</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>corte <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="fu">nrow</span>(datos), <span class="fu">nrow</span>(datos) <span class="sc">*</span> porcentaje)</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>train <span class="ot">&lt;-</span> datos[corte, ]</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>test <span class="ot">&lt;-</span> datos[<span class="sc">-</span>corte, ]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="datos-necesarios-para-svm-y-xgboost" class="level2">
<h2 class="anchored" data-anchor-id="datos-necesarios-para-svm-y-xgboost">Datos necesarios para SVM y XGBoost</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> datos</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>cualitativas2 <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">'MESREG'</span>, <span class="st">'AÑOREG'</span>, <span class="st">'SEXO'</span>, <span class="st">'DIAOCU'</span>, <span class="st">'MESOCU'</span>, <span class="st">'TIPAR'</span>, <span class="st">'ESCIVM'</span>, <span class="st">'ESCOLAM'</span>, <span class="st">'ASISREC'</span>, <span class="st">'SITIOOCU'</span>)</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>cualitativas2_indices <span class="ot">&lt;-</span> <span class="fu">which</span>(<span class="fu">colnames</span>(data) <span class="sc">%in%</span> cualitativas2)</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>data<span class="sc">$</span>TIPO <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(data<span class="sc">$</span>TIPO <span class="sc">==</span> <span class="st">"muerto"</span>, <span class="dv">1</span>, <span class="dv">0</span>)</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>encoding_model <span class="ot">&lt;-</span> <span class="fu">dummyVars</span>(<span class="sc">~</span>., <span class="at">data =</span> data[, cualitativas2_indices], <span class="at">fullRank =</span> <span class="cn">TRUE</span>)</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>encoded_data <span class="ot">&lt;-</span> <span class="fu">predict</span>(encoding_model, <span class="at">newdata =</span> data[, cualitativas2_indices])</span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>final_data <span class="ot">&lt;-</span> <span class="fu">cbind</span>(data[, <span class="sc">!</span>cualitativas2_indices], encoded_data)</span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>final_data<span class="sc">$</span>TIPO <span class="ot">&lt;-</span> data<span class="sc">$</span>TIPO</span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a>porcentaje <span class="ot">&lt;-</span> <span class="fl">0.7</span></span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a>corte <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="fu">nrow</span>(final_data), <span class="fu">nrow</span>(final_data) <span class="sc">*</span> porcentaje)</span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a>train1 <span class="ot">&lt;-</span> final_data[corte, ]</span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a>test1 <span class="ot">&lt;-</span> final_data[<span class="sc">-</span>corte, ]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="svm" class="level2">
<h2 class="anchored" data-anchor-id="svm">SVM</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Dividir los datos en conjuntos de entrenamiento y prueba</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="co"># modeloSVM &lt;- svm(TIPO~., data = train, kernel = "linear", cost = 10, gamma = 0.1)</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>modeloSVM <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">"./modelos/modeloSVM.rds"</span>)</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(modeloSVM)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
svm(formula = TIPO ~ ., data = train, kernel = "linear", cost = 10, 
    gamma = 0.1)


Parameters:
   SVM-Type:  C-classification 
 SVM-Kernel:  linear 
       cost:  10 

Number of Support Vectors:  15031</code></pre>
</div>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>svmpredicciones <span class="ot">&lt;-</span> <span class="fu">predict</span>(modeloSVM, test)</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>svmConfusionMatrix <span class="ot">&lt;-</span> <span class="fu">confusionMatrix</span>(svmpredicciones, test<span class="sc">$</span>TIPO)</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(svmConfusionMatrix)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Confusion Matrix and Statistics

          Reference
Prediction muerto vivo
    muerto   3932  737
    vivo        0 7482
                                         
               Accuracy : 0.9393         
                 95% CI : (0.935, 0.9435)
    No Information Rate : 0.6764         
    P-Value [Acc &gt; NIR] : &lt; 2.2e-16      
                                         
                  Kappa : 0.8679         
                                         
 Mcnemar's Test P-Value : &lt; 2.2e-16      
                                         
            Sensitivity : 1.0000         
            Specificity : 0.9103         
         Pos Pred Value : 0.8422         
         Neg Pred Value : 1.0000         
             Prevalence : 0.3236         
         Detection Rate : 0.3236         
   Detection Prevalence : 0.3842         
      Balanced Accuracy : 0.9552         
                                         
       'Positive' Class : muerto         
                                         </code></pre>
</div>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># saveRDS(modeloSVM, "./modelos/modeloSVM.rds")</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># library(mlr)</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="co"># library(ggplot2)</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="co"># # Paso 1: Cargar los datos y crear la tarea</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a><span class="co"># train1$TIPO &lt;- train$TIPO</span></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a><span class="co"># datos.task &lt;- makeClassifTask(data = train1, target = "TIPO")</span></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a><span class="co"># # Paso 2: Definir la configuración de la validación cruzada</span></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a><span class="co"># rin2 &lt;- makeResampleDesc(method = "CV", iters = 10, predict = "both")</span></span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a><span class="co"># # Paso 3: Definir el clasificador SVM</span></span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a><span class="co"># lrn &lt;- makeLearner("classif.svm", kernel = "radial", cost = 1, gamma = 0.1)</span></span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a><span class="co"># # Paso 4: Generar los datos de la curva de aprendizaje</span></span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a><span class="co"># lc2 &lt;- generateLearningCurveData(</span></span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a><span class="co">#   learners = lrn,</span></span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a><span class="co">#   task = datos.task,</span></span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a><span class="co">#   percs = seq(0.1, 1, by = 0.1),</span></span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a><span class="co">#   measures = list(ber, setAggregation(ber, train.mean)),</span></span>
<span id="cb9-20"><a href="#cb9-20" aria-hidden="true" tabindex="-1"></a><span class="co">#   resampling = rin2,</span></span>
<span id="cb9-21"><a href="#cb9-21" aria-hidden="true" tabindex="-1"></a><span class="co">#   show.info = FALSE</span></span>
<span id="cb9-22"><a href="#cb9-22" aria-hidden="true" tabindex="-1"></a><span class="co"># )</span></span>
<span id="cb9-23"><a href="#cb9-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-24"><a href="#cb9-24" aria-hidden="true" tabindex="-1"></a><span class="co"># # Paso 5: Graficar la curva de aprendizaje</span></span>
<span id="cb9-25"><a href="#cb9-25" aria-hidden="true" tabindex="-1"></a><span class="co"># p &lt;- plotLearningCurve(lc2, facet = "learner")</span></span>
<span id="cb9-26"><a href="#cb9-26" aria-hidden="true" tabindex="-1"></a><span class="co"># p</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>folds <span class="ot">&lt;-</span> <span class="fu">createFolds</span>(train<span class="sc">$</span>TIPO, <span class="at">k =</span> <span class="dv">25</span>, <span class="at">list =</span> <span class="cn">TRUE</span>, <span class="at">returnTrain =</span> <span class="cn">TRUE</span>)</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>    rmse_train <span class="ot">&lt;-</span> <span class="fu">vector</span>(<span class="at">length =</span> <span class="fu">length</span>(folds))</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>    rmse_test <span class="ot">&lt;-</span> <span class="fu">vector</span>(<span class="at">length =</span> <span class="fu">length</span>(folds))</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(folds)){</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>        train_data <span class="ot">&lt;-</span> train[folds[[i]],]</span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>        test_data <span class="ot">&lt;-</span> train[<span class="sc">-</span>folds[[i]],]</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>        pred_train <span class="ot">&lt;-</span> <span class="fu">predict</span>(modeloSVM, <span class="at">newdata =</span> train_data )</span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>        pred <span class="ot">&lt;-</span> <span class="fu">predict</span>(modeloSVM, <span class="at">newdata =</span> test_data)</span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a>        rmse_train[i] <span class="ot">&lt;-</span> <span class="fu">confusionMatrix</span>(pred_train, train_data<span class="sc">$</span>TIPO)<span class="sc">$</span>overall[<span class="st">"Accuracy"</span>]</span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a>        rmse_test[i] <span class="ot">&lt;-</span> <span class="fu">confusionMatrix</span>(pred, test_data<span class="sc">$</span>TIPO)<span class="sc">$</span>overall[<span class="st">"Accuracy"</span>]</span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a>    rmse_df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb10-19"><a href="#cb10-19" aria-hidden="true" tabindex="-1"></a>  <span class="at">Fold =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(folds),</span>
<span id="cb10-20"><a href="#cb10-20" aria-hidden="true" tabindex="-1"></a>  <span class="at">RMSE_Train =</span> rmse_train,</span>
<span id="cb10-21"><a href="#cb10-21" aria-hidden="true" tabindex="-1"></a>  <span class="at">RMSE_Test =</span> rmse_test</span>
<span id="cb10-22"><a href="#cb10-22" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb10-23"><a href="#cb10-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-24"><a href="#cb10-24" aria-hidden="true" tabindex="-1"></a><span class="co"># Crear el gráfico de línea</span></span>
<span id="cb10-25"><a href="#cb10-25" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(rmse_df, <span class="fu">aes</span>(<span class="at">x =</span> Fold)) <span class="sc">+</span></span>
<span id="cb10-26"><a href="#cb10-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> RMSE_Train, <span class="at">color =</span> <span class="st">"Conjunto de Entrenamiento"</span>)) <span class="sc">+</span></span>
<span id="cb10-27"><a href="#cb10-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> RMSE_Test, <span class="at">color =</span> <span class="st">"Conjunto de Prueba"</span>)) <span class="sc">+</span></span>
<span id="cb10-28"><a href="#cb10-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Valores de RMSE en la validación cruzada"</span>,</span>
<span id="cb10-29"><a href="#cb10-29" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Fold"</span>,</span>
<span id="cb10-30"><a href="#cb10-30" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"RMSE"</span>) <span class="sc">+</span></span>
<span id="cb10-31"><a href="#cb10-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"Conjunto de Entrenamiento"</span> <span class="ot">=</span> <span class="st">"blue"</span>, <span class="st">"Conjunto de Prueba"</span> <span class="ot">=</span> <span class="st">"red"</span>)) <span class="sc">+</span></span>
<span id="cb10-32"><a href="#cb10-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Proyecto_modelos_files/figure-html/unnamed-chunk-10-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="red-neuronal" class="level2">
<h2 class="anchored" data-anchor-id="red-neuronal">Red neuronal</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>porcentaje <span class="ot">&lt;-</span> <span class="fl">0.5</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>corte <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="fu">nrow</span>(test), <span class="fu">nrow</span>(test) <span class="sc">*</span> porcentaje)</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>test2 <span class="ot">&lt;-</span> test[corte, ]</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>validation2 <span class="ot">&lt;-</span> test[<span class="sc">-</span>corte,]</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(nnet)</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>nnet_model <span class="ot">&lt;-</span> <span class="fu">nnet</span>(TIPO <span class="sc">~</span> ., <span class="at">data =</span> train, <span class="at">size =</span> <span class="dv">5</span>, <span class="at">softmax =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># weights:  396
initial  value 18339.201738 
iter  10 value 17704.378165
iter  20 value 16395.784255
iter  30 value 4893.348033
iter  40 value 4661.117255
iter  50 value 4445.549744
iter  60 value 4288.147367
iter  70 value 4225.320036
iter  80 value 4159.492490
iter  90 value 4095.442639
iter 100 value 4062.365212
final  value 4062.365212 
stopped after 100 iterations</code></pre>
</div>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Make predictions on the test set</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>predictions1 <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(<span class="fu">predict</span>(nnet_model, <span class="at">newdata =</span> test2, <span class="at">type =</span> <span class="st">"class"</span>))</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>predictions2 <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(<span class="fu">predict</span>(nnet_model, <span class="at">newdata =</span> validation2, <span class="at">type =</span> <span class="st">"class"</span>))</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>confusion_matrix <span class="ot">&lt;-</span> <span class="fu">confusionMatrix</span>(<span class="at">reference =</span> test2<span class="sc">$</span>TIPO, <span class="at">data =</span> predictions1)</span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>confusion_matrix2 <span class="ot">&lt;-</span> <span class="fu">confusionMatrix</span>(<span class="at">reference =</span> validation2<span class="sc">$</span>TIPO, <span class="at">data =</span> predictions2)</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>confusion_matrix</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Confusion Matrix and Statistics

          Reference
Prediction muerto vivo
    muerto   1916  290
    vivo       30 3839
                                          
               Accuracy : 0.9473          
                 95% CI : (0.9414, 0.9528)
    No Information Rate : 0.6797          
    P-Value [Acc &gt; NIR] : &lt; 2.2e-16       
                                          
                  Kappa : 0.8832          
                                          
 Mcnemar's Test P-Value : &lt; 2.2e-16       
                                          
            Sensitivity : 0.9846          
            Specificity : 0.9298          
         Pos Pred Value : 0.8685          
         Neg Pred Value : 0.9922          
             Prevalence : 0.3203          
         Detection Rate : 0.3154          
   Detection Prevalence : 0.3631          
      Balanced Accuracy : 0.9572          
                                          
       'Positive' Class : muerto          
                                          </code></pre>
</div>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>confusion_matrix2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Confusion Matrix and Statistics

          Reference
Prediction muerto vivo
    muerto   1966  293
    vivo       20 3797
                                          
               Accuracy : 0.9485          
                 95% CI : (0.9426, 0.9539)
    No Information Rate : 0.6731          
    P-Value [Acc &gt; NIR] : &lt; 2.2e-16       
                                          
                  Kappa : 0.8869          
                                          
 Mcnemar's Test P-Value : &lt; 2.2e-16       
                                          
            Sensitivity : 0.9899          
            Specificity : 0.9284          
         Pos Pred Value : 0.8703          
         Neg Pred Value : 0.9948          
             Prevalence : 0.3269          
         Detection Rate : 0.3236          
   Detection Prevalence : 0.3718          
      Balanced Accuracy : 0.9591          
                                          
       'Positive' Class : muerto          
                                          </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>datos.task <span class="ot">=</span> <span class="fu">makeClassifTask</span>(<span class="at">data =</span> train, <span class="at">target =</span> <span class="st">"TIPO"</span>)</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>rin2 <span class="ot">=</span> <span class="fu">makeResampleDesc</span>(<span class="at">method =</span> <span class="st">"CV"</span>, <span class="at">iters =</span> <span class="dv">10</span>, <span class="at">predict =</span> <span class="st">"both"</span>)</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>lrn <span class="ot">=</span> <span class="fu">makeLearner</span>(<span class="st">"classif.nnet"</span>, <span class="at">size =</span> <span class="dv">5</span>, <span class="at">decay =</span> <span class="fl">1e-4</span>, <span class="at">maxit =</span> <span class="dv">1000</span>, <span class="at">trace =</span> <span class="cn">FALSE</span>)</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>lc2 <span class="ot">=</span> <span class="fu">generateLearningCurveData</span>(<span class="at">learners =</span> lrn, <span class="at">task =</span> datos.task,</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">percs =</span> <span class="fu">seq</span>(<span class="fl">0.1</span>, <span class="dv">1</span>, <span class="at">by =</span> <span class="fl">0.1</span>),</span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">measures =</span> <span class="fu">list</span>(ber, <span class="fu">setAggregation</span>(ber, train.mean)), <span class="at">resampling =</span> rin2,</span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">show.info =</span> <span class="cn">FALSE</span>)</span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a><span class="fu">plotLearningCurve</span>(lc2, <span class="at">facet =</span> <span class="st">"learner"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Proyecto_modelos_files/figure-html/unnamed-chunk-12-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="xgboost" class="level2">
<h2 class="anchored" data-anchor-id="xgboost">XGBoost</h2>
<section id="parameter-tunning" class="level3">
<h3 class="anchored" data-anchor-id="parameter-tunning">Parameter tunning</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>train1<span class="sc">$</span>TIPO <span class="ot">&lt;-</span> train<span class="sc">$</span>TIPO</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>task <span class="ot">&lt;-</span> <span class="fu">makeClassifTask</span>(<span class="at">data =</span> train1, <span class="at">target =</span> <span class="st">"TIPO"</span>)</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>param_grid <span class="ot">&lt;-</span> <span class="fu">makeParamSet</span>(</span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">makeDiscreteParam</span>(<span class="st">"nrounds"</span>, <span class="at">values =</span> <span class="fu">seq</span>(<span class="dv">100</span>, <span class="dv">500</span>, <span class="at">by =</span> <span class="dv">20</span>)),</span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">makeIntegerParam</span>(<span class="st">"max_depth"</span>, <span class="at">lower =</span> <span class="dv">3</span>, <span class="at">upper =</span> <span class="dv">10</span>),</span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">makeNumericParam</span>(<span class="st">"eta"</span>, <span class="at">lower =</span> <span class="fl">0.01</span>, <span class="at">upper =</span> <span class="fl">0.3</span>)</span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a>control_tune <span class="ot">&lt;-</span> <span class="fu">makeTuneControlRandom</span>(<span class="at">maxit =</span> <span class="dv">30</span>)</span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a>resampling <span class="ot">&lt;-</span> <span class="fu">makeResampleDesc</span>(<span class="st">"CV"</span>, <span class="at">iters =</span> <span class="dv">5</span>)</span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a>measure <span class="ot">&lt;-</span> acc</span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a>tuned_model <span class="ot">&lt;-</span> <span class="fu">tuneParams</span>(</span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">learner =</span> <span class="st">"classif.xgboost"</span>,  <span class="co"># For classification, use "classif.xgboost"; for regression, use "regr.xgboost"</span></span>
<span id="cb18-14"><a href="#cb18-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">task =</span> task,</span>
<span id="cb18-15"><a href="#cb18-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">resampling =</span> resampling,</span>
<span id="cb18-16"><a href="#cb18-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">measures =</span> measure,</span>
<span id="cb18-17"><a href="#cb18-17" aria-hidden="true" tabindex="-1"></a>  <span class="at">par.set =</span> param_grid,</span>
<span id="cb18-18"><a href="#cb18-18" aria-hidden="true" tabindex="-1"></a>  <span class="at">control =</span> control_tune,</span>
<span id="cb18-19"><a href="#cb18-19" aria-hidden="true" tabindex="-1"></a>  <span class="at">show.info =</span> <span class="cn">TRUE</span></span>
<span id="cb18-20"><a href="#cb18-20" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>[Tune] Started tuning learner classif.xgboost for parameter set:</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>              Type len Def                                   Constr Req Tunable
nrounds   discrete   -   - 100,120,140,160,180,200,220,240,260,2...   -    TRUE
max_depth  integer   -   -                                  3 to 10   -    TRUE
eta        numeric   -   -                              0.01 to 0.3   -    TRUE
          Trafo
nrounds       -
max_depth     -
eta           -</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>With control class: TuneControlRandom</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Imputation value: -0</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>[Tune-x] 1: nrounds=180; max_depth=5; eta=0.125</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>[Tune-y] 1: acc.test.mean=0.7905615; time: 0.2 min</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>[Tune-x] 2: nrounds=340; max_depth=6; eta=0.104</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>[Tune-y] 2: acc.test.mean=0.7907379; time: 0.4 min</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>[Tune-x] 3: nrounds=320; max_depth=6; eta=0.27</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>[Tune-y] 3: acc.test.mean=0.7818495; time: 0.4 min</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>[Tune-x] 4: nrounds=140; max_depth=6; eta=0.273</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>[Tune-y] 4: acc.test.mean=0.7909143; time: 0.2 min</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>[Tune-x] 5: nrounds=280; max_depth=6; eta=0.296</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>[Tune-y] 5: acc.test.mean=0.7839658; time: 0.3 min</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>[Tune-x] 6: nrounds=260; max_depth=7; eta=0.256</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>[Tune-y] 6: acc.test.mean=0.7815322; time: 0.4 min</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>[Tune-x] 7: nrounds=380; max_depth=3; eta=0.165</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>[Tune-y] 7: acc.test.mean=0.7889744; time: 0.2 min</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>[Tune-x] 8: nrounds=240; max_depth=6; eta=0.137</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>[Tune-y] 8: acc.test.mean=0.7906674; time: 0.3 min</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>[Tune-x] 9: nrounds=100; max_depth=4; eta=0.0814</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>[Tune-y] 9: acc.test.mean=0.7387836; time: 0.1 min</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>[Tune-x] 10: nrounds=200; max_depth=3; eta=0.0278</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>[Tune-y] 10: acc.test.mean=0.7050292; time: 0.1 min</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>[Tune-x] 11: nrounds=420; max_depth=3; eta=0.0885</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>[Tune-y] 11: acc.test.mean=0.7800859; time: 0.3 min</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>[Tune-x] 12: nrounds=120; max_depth=4; eta=0.225</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>[Tune-y] 12: acc.test.mean=0.7880574; time: 0.1 min</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>[Tune-x] 13: nrounds=220; max_depth=10; eta=0.16</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>[Tune-y] 13: acc.test.mean=0.7778287; time: 0.5 min</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>[Tune-x] 14: nrounds=480; max_depth=7; eta=0.123</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>[Tune-y] 14: acc.test.mean=0.7845301; time: 0.7 min</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>[Tune-x] 15: nrounds=500; max_depth=4; eta=0.151</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>[Tune-y] 15: acc.test.mean=0.7945118; time: 0.4 min</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>[Tune-x] 16: nrounds=300; max_depth=5; eta=0.199</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>[Tune-y] 16: acc.test.mean=0.7915844; time: 0.3 min</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>[Tune-x] 17: nrounds=120; max_depth=6; eta=0.154</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>[Tune-y] 17: acc.test.mean=0.7883395; time: 0.1 min</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>[Tune-x] 18: nrounds=200; max_depth=5; eta=0.19</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>[Tune-y] 18: acc.test.mean=0.7933127; time: 0.2 min</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>[Tune-x] 19: nrounds=220; max_depth=3; eta=0.0925</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>[Tune-y] 19: acc.test.mean=0.7603697; time: 0.1 min</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>[Tune-x] 20: nrounds=120; max_depth=8; eta=0.0218</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>[Tune-y] 20: acc.test.mean=0.7121186; time: 0.2 min</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>[Tune-x] 21: nrounds=340; max_depth=4; eta=0.0138</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>[Tune-y] 21: acc.test.mean=0.7073923; time: 0.3 min</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>[Tune-x] 22: nrounds=300; max_depth=3; eta=0.218</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>[Tune-y] 22: acc.test.mean=0.7916902; time: 0.2 min</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>[Tune-x] 23: nrounds=320; max_depth=6; eta=0.0848</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>[Tune-y] 23: acc.test.mean=0.7915492; time: 0.4 min</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>[Tune-x] 24: nrounds=160; max_depth=10; eta=0.175</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>[Tune-y] 24: acc.test.mean=0.7823434; time: 0.4 min</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>[Tune-x] 25: nrounds=260; max_depth=7; eta=0.0852</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>[Tune-y] 25: acc.test.mean=0.7887275; time: 0.4 min</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>[Tune-x] 26: nrounds=480; max_depth=10; eta=0.294</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>[Tune-y] 26: acc.test.mean=0.7595231; time: 1.0 min</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>[Tune-x] 27: nrounds=320; max_depth=8; eta=0.297</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>[Tune-y] 27: acc.test.mean=0.7727144; time: 0.5 min</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>[Tune-x] 28: nrounds=380; max_depth=6; eta=0.206</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>[Tune-y] 28: acc.test.mean=0.7838953; time: 0.5 min</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>[Tune-x] 29: nrounds=280; max_depth=9; eta=0.103</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>[Tune-y] 29: acc.test.mean=0.7841421; time: 0.5 min</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>[Tune-x] 30: nrounds=240; max_depth=10; eta=0.292</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>[Tune-y] 30: acc.test.mean=0.7694343; time: 0.5 min</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>[Tune] Result: nrounds=500; max_depth=4; eta=0.151 : acc.test.mean=0.7945118</code></pre>
</div>
<div class="sourceCode cell-code" id="cb84"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a>best_params <span class="ot">&lt;-</span> tuned_model<span class="sc">$</span>x</span>
<span id="cb84-2"><a href="#cb84-2" aria-hidden="true" tabindex="-1"></a>best_params</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$nrounds
[1] 500

$max_depth
[1] 4

$eta
[1] 0.1510747</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb86"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a>xgb_model <span class="ot">&lt;-</span> <span class="fu">xgboost</span>(<span class="at">data =</span> <span class="fu">as.matrix</span>(train1[, <span class="sc">-</span><span class="fu">which</span>(<span class="fu">colnames</span>(train1) <span class="sc">==</span> <span class="st">"TIPO"</span>)]), </span>
<span id="cb86-2"><a href="#cb86-2" aria-hidden="true" tabindex="-1"></a>                     <span class="at">label =</span> train1[, <span class="fu">c</span>(<span class="st">'TIPO'</span>)],</span>
<span id="cb86-3"><a href="#cb86-3" aria-hidden="true" tabindex="-1"></a>                     <span class="at">nrounds =</span> <span class="dv">500</span>, <span class="at">max_depth=</span><span class="dv">4</span>, <span class="at">eta=</span><span class="fl">0.2254931</span>, <span class="at">verbose=</span><span class="dv">0</span>)</span>
<span id="cb86-4"><a href="#cb86-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-5"><a href="#cb86-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Make predictions</span></span>
<span id="cb86-6"><a href="#cb86-6" aria-hidden="true" tabindex="-1"></a>predictions <span class="ot">&lt;-</span> <span class="fu">predict</span>(xgb_model, <span class="fu">as.matrix</span>(test1[, <span class="sc">-</span><span class="fu">which</span>(<span class="fu">colnames</span>(test1) <span class="sc">==</span> <span class="st">"TIPO"</span>)]))</span>
<span id="cb86-7"><a href="#cb86-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-8"><a href="#cb86-8" aria-hidden="true" tabindex="-1"></a>predictions <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(predictions <span class="sc">&gt;</span> <span class="fl">0.5</span>, <span class="dv">1</span>, <span class="dv">0</span>)</span>
<span id="cb86-9"><a href="#cb86-9" aria-hidden="true" tabindex="-1"></a>predictions <span class="ot">&lt;-</span> <span class="fu">factor</span>(predictions)</span>
<span id="cb86-10"><a href="#cb86-10" aria-hidden="true" tabindex="-1"></a><span class="co"># datos2 &lt;- as.data.frame(datos2)</span></span>
<span id="cb86-11"><a href="#cb86-11" aria-hidden="true" tabindex="-1"></a><span class="co"># datos2$TIPO &lt;- factor(datos2$TIPO, levels = c('0', '1'))</span></span>
<span id="cb86-12"><a href="#cb86-12" aria-hidden="true" tabindex="-1"></a><span class="co"># datos2$TIPO</span></span>
<span id="cb86-13"><a href="#cb86-13" aria-hidden="true" tabindex="-1"></a>confusion_matrix <span class="ot">&lt;-</span> <span class="fu">confusionMatrix</span>(<span class="at">reference =</span> <span class="fu">as.factor</span>(test1<span class="sc">$</span>TIPO), <span class="at">data =</span> predictions)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in confusionMatrix.default(reference = as.factor(test1$TIPO), data
= predictions): Levels are not in the same order for reference and data.
Refactoring data to match.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb88"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a>confusion_matrix</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Confusion Matrix and Statistics

          Reference
Prediction    0    1
         0    0    0
         1 8219 3932
                                         
               Accuracy : 0.3236         
                 95% CI : (0.3153, 0.332)
    No Information Rate : 0.6764         
    P-Value [Acc &gt; NIR] : 1              
                                         
                  Kappa : 0              
                                         
 Mcnemar's Test P-Value : &lt;2e-16         
                                         
            Sensitivity : 0.0000         
            Specificity : 1.0000         
         Pos Pred Value :    NaN         
         Neg Pred Value : 0.3236         
             Prevalence : 0.6764         
         Detection Rate : 0.0000         
   Detection Prevalence : 0.0000         
      Balanced Accuracy : 0.5000         
                                         
       'Positive' Class : 0              
                                         </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb90"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true" tabindex="-1"></a>train1<span class="sc">$</span>TIPO <span class="ot">&lt;-</span> train<span class="sc">$</span>TIPO</span>
<span id="cb90-2"><a href="#cb90-2" aria-hidden="true" tabindex="-1"></a>datos.task <span class="ot">&lt;-</span> <span class="fu">makeClassifTask</span>(<span class="at">data =</span> train1, <span class="at">target =</span> <span class="st">"TIPO"</span>)</span>
<span id="cb90-3"><a href="#cb90-3" aria-hidden="true" tabindex="-1"></a>rin2 <span class="ot">&lt;-</span> <span class="fu">makeResampleDesc</span>(<span class="at">method =</span> <span class="st">"CV"</span>, <span class="at">iters =</span> <span class="dv">10</span>, <span class="at">predict =</span> <span class="st">"both"</span>)</span>
<span id="cb90-4"><a href="#cb90-4" aria-hidden="true" tabindex="-1"></a>lrn <span class="ot">&lt;-</span> <span class="fu">makeLearner</span>(<span class="st">"classif.xgboost"</span>, <span class="at">nrounds =</span> <span class="dv">500</span>, <span class="at">max_depth =</span> <span class="dv">4</span>, <span class="at">eta =</span> <span class="fl">0.2254931</span>)</span>
<span id="cb90-5"><a href="#cb90-5" aria-hidden="true" tabindex="-1"></a>lc2 <span class="ot">&lt;-</span> <span class="fu">generateLearningCurveData</span>(</span>
<span id="cb90-6"><a href="#cb90-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">learners =</span> lrn,</span>
<span id="cb90-7"><a href="#cb90-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">task =</span> datos.task,</span>
<span id="cb90-8"><a href="#cb90-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">percs =</span> <span class="fu">seq</span>(<span class="fl">0.1</span>, <span class="dv">1</span>, <span class="at">by =</span> <span class="fl">0.1</span>),</span>
<span id="cb90-9"><a href="#cb90-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">measures =</span> <span class="fu">list</span>(ber, <span class="fu">setAggregation</span>(ber, train.mean)),</span>
<span id="cb90-10"><a href="#cb90-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">resampling =</span> rin2,</span>
<span id="cb90-11"><a href="#cb90-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">show.info =</span> <span class="cn">FALSE</span></span>
<span id="cb90-12"><a href="#cb90-12" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb90-13"><a href="#cb90-13" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> <span class="fu">plotLearningCurve</span>(lc2, <span class="at">facet =</span> <span class="st">"learner"</span>)</span>
<span id="cb90-14"><a href="#cb90-14" aria-hidden="true" tabindex="-1"></a>p</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Proyecto_modelos_files/figure-html/unnamed-chunk-15-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
</section>
<section id="random-forest" class="level2">
<h2 class="anchored" data-anchor-id="random-forest">Random Forest</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb91"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb91-2"><a href="#cb91-2" aria-hidden="true" tabindex="-1"></a>modelo_rf <span class="ot">&lt;-</span> <span class="fu">randomForest</span>(TIPO <span class="sc">~</span> ., <span class="at">data =</span> train, <span class="at">ntree =</span> <span class="dv">100</span>)</span>
<span id="cb91-3"><a href="#cb91-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-4"><a href="#cb91-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-5"><a href="#cb91-5" aria-hidden="true" tabindex="-1"></a>predicciones <span class="ot">&lt;-</span> <span class="fu">predict</span>(modelo_rf, test)</span>
<span id="cb91-6"><a href="#cb91-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-7"><a href="#cb91-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-8"><a href="#cb91-8" aria-hidden="true" tabindex="-1"></a>confusion_matrix <span class="ot">&lt;-</span> <span class="fu">confusionMatrix</span>(<span class="at">reference=</span>test<span class="sc">$</span>TIPO, <span class="at">data =</span> predicciones)</span>
<span id="cb91-9"><a href="#cb91-9" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(confusion_matrix)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Confusion Matrix and Statistics

          Reference
Prediction muerto vivo
    muerto   3808  449
    vivo      124 7770
                                          
               Accuracy : 0.9528          
                 95% CI : (0.9489, 0.9565)
    No Information Rate : 0.6764          
    P-Value [Acc &gt; NIR] : &lt; 2.2e-16       
                                          
                  Kappa : 0.8946          
                                          
 Mcnemar's Test P-Value : &lt; 2.2e-16       
                                          
            Sensitivity : 0.9685          
            Specificity : 0.9454          
         Pos Pred Value : 0.8945          
         Neg Pred Value : 0.9843          
             Prevalence : 0.3236          
         Detection Rate : 0.3134          
   Detection Prevalence : 0.3503          
      Balanced Accuracy : 0.9569          
                                          
       'Positive' Class : muerto          
                                          </code></pre>
</div>
</div>
<section id="parameter-tuning" class="level3">
<h3 class="anchored" data-anchor-id="parameter-tuning">Parameter tuning</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb93"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true" tabindex="-1"></a>classifier <span class="ot">&lt;-</span> <span class="fu">makeClassifTask</span>(</span>
<span id="cb93-2"><a href="#cb93-2" aria-hidden="true" tabindex="-1"></a>    <span class="at">data=</span>train, </span>
<span id="cb93-3"><a href="#cb93-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">target=</span><span class="st">"TIPO"</span></span>
<span id="cb93-4"><a href="#cb93-4" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb93-5"><a href="#cb93-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-6"><a href="#cb93-6" aria-hidden="true" tabindex="-1"></a>param_grid <span class="ot">&lt;-</span> <span class="fu">makeParamSet</span>(<span class="fu">makeDiscreteParam</span>(<span class="st">"ntree"</span>,<span class="at">values=</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">300</span>, <span class="at">by =</span> <span class="dv">25</span>)))</span>
<span id="cb93-7"><a href="#cb93-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-8"><a href="#cb93-8" aria-hidden="true" tabindex="-1"></a>control_grid <span class="ot">&lt;-</span> <span class="fu">makeTuneControlGrid</span>()</span>
<span id="cb93-9"><a href="#cb93-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-10"><a href="#cb93-10" aria-hidden="true" tabindex="-1"></a>resample <span class="ot">&lt;-</span> <span class="fu">makeResampleDesc</span>(<span class="st">"CV"</span>, <span class="at">iters =</span> 3L)</span>
<span id="cb93-11"><a href="#cb93-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-12"><a href="#cb93-12" aria-hidden="true" tabindex="-1"></a>measure <span class="ot">&lt;-</span> acc</span>
<span id="cb93-13"><a href="#cb93-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-14"><a href="#cb93-14" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb93-15"><a href="#cb93-15" aria-hidden="true" tabindex="-1"></a>dt_tuneparam <span class="ot">&lt;-</span> <span class="fu">tuneParams</span>(<span class="at">learner=</span><span class="st">'classif.randomForest'</span>, </span>
<span id="cb93-16"><a href="#cb93-16" aria-hidden="true" tabindex="-1"></a> <span class="at">task=</span>classifier, </span>
<span id="cb93-17"><a href="#cb93-17" aria-hidden="true" tabindex="-1"></a> <span class="at">resampling =</span> resample,</span>
<span id="cb93-18"><a href="#cb93-18" aria-hidden="true" tabindex="-1"></a> <span class="at">measures =</span> measure,</span>
<span id="cb93-19"><a href="#cb93-19" aria-hidden="true" tabindex="-1"></a> <span class="at">par.set=</span>param_grid, </span>
<span id="cb93-20"><a href="#cb93-20" aria-hidden="true" tabindex="-1"></a> <span class="at">control=</span>control_grid, </span>
<span id="cb93-21"><a href="#cb93-21" aria-hidden="true" tabindex="-1"></a> <span class="at">show.info =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>[Tune] Started tuning learner classif.randomForest for parameter set:</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>          Type len Def                                   Constr Req Tunable
ntree discrete   -   - 0,25,50,75,100,125,150,175,200,225,25...   -    TRUE
      Trafo
ntree     -</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>With control class: TuneControlGrid</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Imputation value: -0</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>[Tune-x] Setting hyperpars failed: Error in setHyperPars2.Learner(learner, insert(par.vals, args)) : 
  0 is not feasible for parameter 'ntree'!</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>[Tune-x] 1: ntree=0</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>[Tune-y] 1: acc.test.mean=      NA; time: 0.0 min</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>[Tune-x] 2: ntree=25</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>[Tune-y] 2: acc.test.mean=0.9492452; time: 0.0 min</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>[Tune-x] 3: ntree=50</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>[Tune-y] 3: acc.test.mean=0.9517142; time: 0.0 min</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>[Tune-x] 4: ntree=75</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>[Tune-y] 4: acc.test.mean=0.9518552; time: 0.0 min</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>[Tune-x] 5: ntree=100</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>[Tune-y] 5: acc.test.mean=0.9524901; time: 0.1 min</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>[Tune-x] 6: ntree=125</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>[Tune-y] 6: acc.test.mean=0.9521726; time: 0.1 min</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>[Tune-x] 7: ntree=150</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>[Tune-y] 7: acc.test.mean=0.9530897; time: 0.1 min</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>[Tune-x] 8: ntree=175</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>[Tune-y] 8: acc.test.mean=0.9527017; time: 0.1 min</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>[Tune-x] 9: ntree=200</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>[Tune-y] 9: acc.test.mean=0.9524901; time: 0.1 min</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>[Tune-x] 10: ntree=225</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>[Tune-y] 10: acc.test.mean=0.9532660; time: 0.1 min</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>[Tune-x] 11: ntree=250</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>[Tune-y] 11: acc.test.mean=0.9531250; time: 0.1 min</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>[Tune-x] 12: ntree=275</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>[Tune-y] 12: acc.test.mean=0.9528781; time: 0.1 min</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>[Tune-x] 13: ntree=300</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>[Tune-y] 13: acc.test.mean=0.9532308; time: 0.1 min</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>[Tune] Result: ntree=225 : acc.test.mean=0.9532660</code></pre>
</div>
<div class="sourceCode cell-code" id="cb126"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb126-1"><a href="#cb126-1" aria-hidden="true" tabindex="-1"></a>result_hyperparam <span class="ot">&lt;-</span> <span class="fu">generateHyperParsEffectData</span>(dt_tuneparam, <span class="at">partial.dep =</span> <span class="cn">TRUE</span>)</span>
<span id="cb126-2"><a href="#cb126-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb126-3"><a href="#cb126-3" aria-hidden="true" tabindex="-1"></a>best_parameters <span class="ot">=</span> <span class="fu">setHyperPars</span>(</span>
<span id="cb126-4"><a href="#cb126-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">makeLearner</span>(<span class="st">"classif.randomForest"</span>), </span>
<span id="cb126-5"><a href="#cb126-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">par.vals =</span> dt_tuneparam<span class="sc">$</span>x</span>
<span id="cb126-6"><a href="#cb126-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb126-7"><a href="#cb126-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb126-8"><a href="#cb126-8" aria-hidden="true" tabindex="-1"></a>best_model <span class="ot">=</span> <span class="fu">train</span>(best_parameters, classifier)</span>
<span id="cb126-9"><a href="#cb126-9" aria-hidden="true" tabindex="-1"></a>best_params <span class="ot">&lt;-</span> <span class="fu">getHyperPars</span>(best_model<span class="sc">$</span>learner)</span>
<span id="cb126-10"><a href="#cb126-10" aria-hidden="true" tabindex="-1"></a>best_params</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$ntree
[1] 225</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb128"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb128-1"><a href="#cb128-1" aria-hidden="true" tabindex="-1"></a>datos.task <span class="ot">=</span> <span class="fu">makeClassifTask</span>(<span class="at">data =</span> train, <span class="at">target =</span> <span class="st">"TIPO"</span>)</span>
<span id="cb128-2"><a href="#cb128-2" aria-hidden="true" tabindex="-1"></a>rin2 <span class="ot">=</span> <span class="fu">makeResampleDesc</span>(<span class="at">method =</span> <span class="st">"CV"</span>, <span class="at">iters =</span> <span class="dv">10</span>, <span class="at">predict =</span> <span class="st">"both"</span>)</span>
<span id="cb128-3"><a href="#cb128-3" aria-hidden="true" tabindex="-1"></a>lrn <span class="ot">=</span> <span class="fu">makeLearner</span>(<span class="st">"classif.randomForest"</span>, <span class="at">ntree =</span> <span class="dv">500</span>)</span>
<span id="cb128-4"><a href="#cb128-4" aria-hidden="true" tabindex="-1"></a>lc2 <span class="ot">=</span> <span class="fu">generateLearningCurveData</span>(<span class="at">learners =</span> lrn, <span class="at">task =</span> datos.task,</span>
<span id="cb128-5"><a href="#cb128-5" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">percs =</span> <span class="fu">seq</span>(<span class="fl">0.1</span>, <span class="dv">1</span>, <span class="at">by =</span> <span class="fl">0.1</span>),</span>
<span id="cb128-6"><a href="#cb128-6" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">measures =</span> <span class="fu">list</span>(ber, <span class="fu">setAggregation</span>(ber, train.mean)), <span class="at">resampling =</span> rin2,</span>
<span id="cb128-7"><a href="#cb128-7" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">show.info =</span> <span class="cn">FALSE</span>)</span>
<span id="cb128-8"><a href="#cb128-8" aria-hidden="true" tabindex="-1"></a><span class="fu">plotLearningCurve</span>(lc2, <span class="at">facet =</span> <span class="st">"learner"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Proyecto_modelos_files/figure-html/unnamed-chunk-18-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
</section>
<section id="regresión-logística-regularizada" class="level2">
<h2 class="anchored" data-anchor-id="regresión-logística-regularizada">Regresión logística regularizada</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb129"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb129-1"><a href="#cb129-1" aria-hidden="true" tabindex="-1"></a>X_train <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(<span class="fu">select</span>(train1, <span class="sc">-</span>TIPO))</span>
<span id="cb129-2"><a href="#cb129-2" aria-hidden="true" tabindex="-1"></a>y_train <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(train1<span class="sc">$</span>TIPO)</span>
<span id="cb129-3"><a href="#cb129-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-4"><a href="#cb129-4" aria-hidden="true" tabindex="-1"></a>X_test <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(<span class="fu">select</span>(test1, <span class="sc">-</span>TIPO))</span>
<span id="cb129-5"><a href="#cb129-5" aria-hidden="true" tabindex="-1"></a>y_test <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(test1<span class="sc">$</span>TIPO)</span>
<span id="cb129-6"><a href="#cb129-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-7"><a href="#cb129-7" aria-hidden="true" tabindex="-1"></a>ridge_model <span class="ot">&lt;-</span> <span class="fu">glmnet</span>(X_train, y_train, <span class="at">family =</span> <span class="st">"binomial"</span>, <span class="at">alpha =</span> <span class="dv">1</span>, <span class="at">lambda =</span> <span class="dv">0</span>)</span>
<span id="cb129-8"><a href="#cb129-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-9"><a href="#cb129-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Realizar predicciones en los datos de prueba</span></span>
<span id="cb129-10"><a href="#cb129-10" aria-hidden="true" tabindex="-1"></a>y_pred <span class="ot">&lt;-</span> <span class="fu">predict</span>(ridge_model, <span class="at">newx =</span> X_test, <span class="at">s =</span> <span class="st">"lambda.min"</span>, <span class="at">type =</span> <span class="st">"response"</span>)</span>
<span id="cb129-11"><a href="#cb129-11" aria-hidden="true" tabindex="-1"></a>y_pred <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(y_pred <span class="sc">&gt;</span> <span class="fl">0.5</span>, <span class="dv">1</span>, <span class="dv">0</span>)</span>
<span id="cb129-12"><a href="#cb129-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-13"><a href="#cb129-13" aria-hidden="true" tabindex="-1"></a>cf <span class="ot">&lt;-</span> <span class="fu">confusionMatrix</span>(<span class="at">reference =</span> <span class="fu">as.factor</span>(test1<span class="sc">$</span>TIPO), <span class="at">data =</span> <span class="fu">as.factor</span>(y_pred))</span>
<span id="cb129-14"><a href="#cb129-14" aria-hidden="true" tabindex="-1"></a>cf</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Confusion Matrix and Statistics

          Reference
Prediction    0    1
         0  891 1349
         1 7328 2583
                                         
               Accuracy : 0.2859         
                 95% CI : (0.2779, 0.294)
    No Information Rate : 0.6764         
    P-Value [Acc &gt; NIR] : 1              
                                         
                  Kappa : -0.168         
                                         
 Mcnemar's Test P-Value : &lt;2e-16         
                                         
            Sensitivity : 0.10841        
            Specificity : 0.65692        
         Pos Pred Value : 0.39777        
         Neg Pred Value : 0.26062        
             Prevalence : 0.67641        
         Detection Rate : 0.07333        
   Detection Prevalence : 0.18435        
      Balanced Accuracy : 0.38266        
                                         
       'Positive' Class : 0              
                                         </code></pre>
</div>
</div>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>